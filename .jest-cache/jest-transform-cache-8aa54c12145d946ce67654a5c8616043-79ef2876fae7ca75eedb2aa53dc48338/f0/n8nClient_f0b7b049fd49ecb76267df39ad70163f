ca8d44822df3980ce3255a97dc190876
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.N8nClient = void 0;
const node_fetch_1 = __importDefault(require("node-fetch"));
class N8nClient {
    baseUrl;
    apiKey;
    constructor(baseUrl, apiKey) {
        this.baseUrl = baseUrl;
        this.apiKey = apiKey;
        // Remove trailing slash if present
        this.baseUrl = baseUrl.replace(/\/$/, '');
        // Ensure apiKey is properly assigned
        this.apiKey = apiKey;
    }
    async makeRequest(endpoint, options = {}) {
        const url = `${this.baseUrl}/api/v1${endpoint}`;
        const headers = {
            'X-N8N-API-KEY': this.apiKey,
            Accept: 'application/json',
            'Content-Type': 'application/json',
        };
        try {
            const response = await (0, node_fetch_1.default)(url, {
                ...options,
                headers: {
                    ...headers,
                    ...(options.headers || {}),
                },
            });
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`HTTP ${response.status}: ${errorText}`);
            }
            const contentType = response.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
                return (await response.json());
            }
            return (await response.text());
        }
        catch (error) {
            if (error instanceof Error) {
                throw new Error(`n8n API request failed: ${error.message}`);
            }
            throw new Error('n8n API request failed with unknown error');
        }
    }
    // User Management
    async getUsers(options = {}) {
        const params = new URLSearchParams();
        if (options.limit)
            params.append('limit', options.limit.toString());
        if (options.cursor)
            params.append('cursor', options.cursor);
        const query = params.toString() ? `?${params.toString()}` : '';
        return this.makeRequest(`/users${query}`);
    }
    async getUser(id) {
        return this.makeRequest(`/users/${id}`);
    }
    async createUser(userData) {
        return this.makeRequest('/users', {
            method: 'POST',
            body: JSON.stringify(userData),
        });
    }
    async updateUser(id, userData) {
        return this.makeRequest(`/users/${id}`, {
            method: 'PATCH',
            body: JSON.stringify(userData),
        });
    }
    async deleteUser(id) {
        await this.makeRequest(`/users/${id}`, {
            method: 'DELETE',
        });
    }
    // Workflow Management
    async getWorkflows(options = {}) {
        const params = new URLSearchParams();
        if (options.limit)
            params.append('limit', options.limit.toString());
        if (options.cursor)
            params.append('cursor', options.cursor);
        const query = params.toString() ? `?${params.toString()}` : '';
        return this.makeRequest(`/workflows${query}`);
    }
    async getWorkflow(id) {
        return this.makeRequest(`/workflows/${id}`);
    }
    async createWorkflow(workflowData) {
        return this.makeRequest('/workflows', {
            method: 'POST',
            body: JSON.stringify(workflowData),
        });
    }
    async updateWorkflow(id, workflowData) {
        return this.makeRequest(`/workflows/${id}`, {
            method: 'PUT',
            body: JSON.stringify(workflowData),
        });
    }
    async deleteWorkflow(id) {
        await this.makeRequest(`/workflows/${id}`, {
            method: 'DELETE',
        });
    }
    async activateWorkflow(id) {
        return this.makeRequest(`/workflows/${id}/activate`, {
            method: 'POST',
        });
    }
    async deactivateWorkflow(id) {
        return this.makeRequest(`/workflows/${id}/deactivate`, {
            method: 'POST',
        });
    }
    // Execution Management
    async getExecutions(options = {}) {
        const params = new URLSearchParams();
        if (options.limit)
            params.append('limit', options.limit.toString());
        if (options.cursor)
            params.append('cursor', options.cursor);
        const query = params.toString() ? `?${params.toString()}` : '';
        return this.makeRequest(`/executions${query}`);
    }
    async getExecution(id) {
        return this.makeRequest(`/executions/${id}`);
    }
    async deleteExecution(id) {
        await this.makeRequest(`/executions/${id}`, {
            method: 'DELETE',
        });
    }
    // Credential Management
    async getCredentials(options = {}) {
        const params = new URLSearchParams();
        if (options.limit)
            params.append('limit', options.limit.toString());
        if (options.cursor)
            params.append('cursor', options.cursor);
        const query = params.toString() ? `?${params.toString()}` : '';
        return this.makeRequest(`/credentials${query}`);
    }
    async getCredential(id) {
        return this.makeRequest(`/credentials/${id}`);
    }
    async createCredential(credentialData) {
        return this.makeRequest('/credentials', {
            method: 'POST',
            body: JSON.stringify(credentialData),
        });
    }
    async deleteCredential(id) {
        await this.makeRequest(`/credentials/${id}`, {
            method: 'DELETE',
        });
    }
    async getCredentialSchema(credentialType) {
        return this.makeRequest(`/credentials/schema/${credentialType}`);
    }
    // Project Management (Enterprise)
    async getProjects(options = {}) {
        const params = new URLSearchParams();
        if (options.limit)
            params.append('limit', options.limit.toString());
        if (options.cursor)
            params.append('cursor', options.cursor);
        const query = params.toString() ? `?${params.toString()}` : '';
        return this.makeRequest(`/projects${query}`);
    }
    async createProject(projectData) {
        return this.makeRequest('/projects', {
            method: 'POST',
            body: JSON.stringify(projectData),
        });
    }
    async updateProject(id, projectData) {
        return this.makeRequest(`/projects/${id}`, {
            method: 'PUT',
            body: JSON.stringify(projectData),
        });
    }
    async deleteProject(id) {
        await this.makeRequest(`/projects/${id}`, {
            method: 'DELETE',
        });
    }
    // Variable Management (Enterprise)
    async getVariables(options = {}) {
        const params = new URLSearchParams();
        if (options.limit)
            params.append('limit', options.limit.toString());
        if (options.cursor)
            params.append('cursor', options.cursor);
        const query = params.toString() ? `?${params.toString()}` : '';
        return this.makeRequest(`/variables${query}`);
    }
    async createVariable(variableData) {
        return this.makeRequest('/variables', {
            method: 'POST',
            body: JSON.stringify(variableData),
        });
    }
    async deleteVariable(id) {
        await this.makeRequest(`/variables/${id}`, {
            method: 'DELETE',
        });
    }
    // Tag Management
    async getTags(options = {}) {
        const params = new URLSearchParams();
        if (options.limit)
            params.append('limit', options.limit.toString());
        if (options.cursor)
            params.append('cursor', options.cursor);
        const query = params.toString() ? `?${params.toString()}` : '';
        return this.makeRequest(`/tags${query}`);
    }
    async getTag(id) {
        return this.makeRequest(`/tags/${id}`);
    }
    async createTag(tagData) {
        return this.makeRequest('/tags', {
            method: 'POST',
            body: JSON.stringify(tagData),
        });
    }
    async updateTag(id, tagData) {
        return this.makeRequest(`/tags/${id}`, {
            method: 'PUT',
            body: JSON.stringify(tagData),
        });
    }
    async deleteTag(id) {
        await this.makeRequest(`/tags/${id}`, {
            method: 'DELETE',
        });
    }
    async getWorkflowTags(workflowId) {
        return this.makeRequest(`/workflows/${workflowId}/tags`);
    }
    async updateWorkflowTags(workflowId, tagIds) {
        await this.makeRequest(`/workflows/${workflowId}/tags`, {
            method: 'PUT',
            body: JSON.stringify({ tagIds }),
        });
    }
    // Audit Report
    async generateAuditReport() {
        return this.makeRequest('/audit');
    }
}
exports.N8nClient = N8nClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2plcmVteXBhcmtlci9EZXNrdG9wL0NsYXVkZSBDb2RpbmcgUHJvamVjdHMvbjhuLW1jcC1zZXJ2ZXIvc3JjL2NsaWVudC9uOG5DbGllbnQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsNERBQStCO0FBd0IvQixNQUFhLFNBQVM7SUFFVjtJQUNBO0lBRlYsWUFDVSxPQUFlLEVBQ2YsTUFBYztRQURkLFlBQU8sR0FBUCxPQUFPLENBQVE7UUFDZixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBRXRCLG1DQUFtQztRQUNuQyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzFDLHFDQUFxQztRQUNyQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRU8sS0FBSyxDQUFDLFdBQVcsQ0FDdkIsUUFBZ0IsRUFDaEIsVUFBbUMsRUFBRTtRQUVyQyxNQUFNLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLFVBQVUsUUFBUSxFQUFFLENBQUM7UUFDaEQsTUFBTSxPQUFPLEdBQUc7WUFDZCxlQUFlLEVBQUUsSUFBSSxDQUFDLE1BQU07WUFDNUIsTUFBTSxFQUFFLGtCQUFrQjtZQUMxQixjQUFjLEVBQUUsa0JBQWtCO1NBQ25DLENBQUM7UUFFRixJQUFJLENBQUM7WUFDSCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsb0JBQUssRUFBQyxHQUFHLEVBQUU7Z0JBQ2hDLEdBQUcsT0FBTztnQkFDVixPQUFPLEVBQUU7b0JBQ1AsR0FBRyxPQUFPO29CQUNWLEdBQUcsQ0FBRSxPQUFPLENBQUMsT0FBa0MsSUFBSSxFQUFFLENBQUM7aUJBQ3ZEO2FBQ0YsQ0FBQyxDQUFDO1lBRUgsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDakIsTUFBTSxTQUFTLEdBQUcsTUFBTSxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ3hDLE1BQU0sSUFBSSxLQUFLLENBQUMsUUFB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QUN0QyxPQUFPLElBQUksQ0FBQyxXQUFXLENBQVcsY0FBYyxVQUFVLE9BQU8sQ0FBQyxDQUFDO0lBQ3JFLENBQUM7SUFFRCxLQUFLLENBQUMsa0JBQWtCLENBQUMsVUFBa0IsRUFBRSxNQUFnQjtRQUMzRCxNQUFNLElBQUksQ0FBQyxXQUFXLENBQU8sY0FBYyxVQUFVLE9BQU8sRUFBRTtZQUM1RCxNQUFNLEVBQUUsS0FBSztZQUNiLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUM7U0FDakMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGVBQWU7SUFDZixLQUFLLENBQUMsbUJBQW1CO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBaUIsUUFBUSxDQUFDLENBQUM7SUFDcEQsQ0FBQztDQUNGO0FBM1JELDhCQTJSQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvamVyZW15cGFya2VyL0Rlc2t0b3AvQ2xhdWRlIENvZGluZyBQcm9qZWN0cy9uOG4tbWNwLXNlcnZlci9zcmMvY2xpZW50L244bkNsaWVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZmV0Y2ggZnJvbSAnbm9kZS1mZXRjaCc7XG5pbXBvcnQge1xuICBOOG5Vc2VyLFxuICBOOG5Xb3JrZmxvdyxcbiAgTjhuRXhlY3V0aW9uLFxuICBOOG5DcmVkZW50aWFsLFxuICBOOG5Qcm9qZWN0LFxuICBOOG5WYXJpYWJsZSxcbiAgTjhuVGFnLFxuICBOOG5BdWRpdFJlcG9ydCxcbiAgQXBpUmVzcG9uc2UsXG4gIFBhZ2luYXRpb25PcHRpb25zLFxuICBDcmVhdGVVc2VyUmVxdWVzdCxcbiAgVXBkYXRlVXNlclJlcXVlc3QsXG4gIENyZWF0ZVdvcmtmbG93UmVxdWVzdCxcbiAgVXBkYXRlV29ya2Zsb3dSZXF1ZXN0LFxuICBDcmVhdGVDcmVkZW50aWFsUmVxdWVzdCxcbiAgQ3JlYXRlUHJvamVjdFJlcXVlc3QsXG4gIFVwZGF0ZVByb2plY3RSZXF1ZXN0LFxuICBDcmVhdGVWYXJpYWJsZVJlcXVlc3QsXG4gIENyZWF0ZVRhZ1JlcXVlc3QsXG4gIFVwZGF0ZVRhZ1JlcXVlc3QsXG59IGZyb20gJy4uL3R5cGVzL244bi5qcyc7XG5cbmV4cG9ydCBjbGFzcyBOOG5DbGllbnQge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGJhc2VVcmw6IHN0cmluZyxcbiAgICBwcml2YXRlIGFwaUtleTogc3RyaW5nXG4gICkge1xuICAgIC8vIFJlbW92ZSB0cmFpbGluZyBzbGFzaCBpZiBwcmVzZW50XG4gICAgdGhpcy5iYXNlVXJsID0gYmFzZVVybC5yZXBsYWNlKC9cXC8kLywgJycpO1xuICAgIC8vIEVuc3VyZSBhcGlLZXkgaXMgcHJvcGVybHkgYXNzaWduZWRcbiAgICB0aGlzLmFwaUtleSA9IGFwaUtleTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbWFrZVJlcXVlc3Q8VD4oXG4gICAgZW5kcG9pbnQ6IHN0cmluZyxcbiAgICBvcHRpb25zOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gICk6IFByb21pc2U8VD4ge1xuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vYXBpL3YxJHtlbmRwb2ludH1gO1xuICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICAnWC1OOE4tQVBJLUtFWSc6IHRoaXMuYXBpS2V5LFxuICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIC4uLmhlYWRlcnMsXG4gICAgICAgICAgLi4uKChvcHRpb25zLmhlYWRlcnMgYXMgUmVjb3JkPHN0cmluZywgc3RyaW5nPikgfHwge30pLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhUVFAgJHtyZXNwb25zZS5zdGF0dXN9OiAke2Vycm9yVGV4dH1gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29udGVudFR5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnY29udGVudC10eXBlJyk7XG4gICAgICBpZiAoY29udGVudFR5cGUgJiYgY29udGVudFR5cGUuaW5jbHVkZXMoJ2FwcGxpY2F0aW9uL2pzb24nKSkge1xuICAgICAgICByZXR1cm4gKGF3YWl0IHJlc3BvbnNlLmpzb24oKSkgYXMgVDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIChhd2FpdCByZXNwb25zZS50ZXh0KCkpIGFzIHVua25vd24gYXMgVDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBuOG4gQVBJIHJlcXVlc3QgZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ244biBBUEkgcmVxdWVzdCBmYWlsZWQgd2l0aCB1bmtub3duIGVycm9yJyk7XG4gICAgfVxuICB9XG5cbiAgLy8gVXNlciBNYW5hZ2VtZW50XG4gIGFzeW5jIGdldFVzZXJzKG9wdGlvbnM6IFBhZ2luYXRpb25PcHRpb25zID0ge30pOiBQcm9taXNlPEFwaVJlc3BvbnNlPE44blVzZXJbXT4+IHtcbiAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgaWYgKG9wdGlvbnMubGltaXQpIHBhcmFtcy5hcHBlbmQoJ2xpbWl0Jywgb3B0aW9ucy5saW1pdC50b1N0cmluZygpKTtcbiAgICBpZiAob3B0aW9ucy5jdXJzb3IpIHBhcmFtcy5hcHBlbmQoJ2N1cnNvcicsIG9wdGlvbnMuY3Vyc29yKTtcblxuICAgIGNvbnN0IHF1ZXJ5ID0gcGFyYW1zLnRvU3RyaW5nKCkgPyBgPyR7cGFyYW1zLnRvU3RyaW5nKCl9YCA6ICcnO1xuICAgIHJldHVybiB0aGlzLm1ha2VSZXF1ZXN0PEFwaVJlc3BvbnNlPE44blVzZXJbXT4+KGAvdXNlcnMke3F1ZXJ5fWApO1xuICB9XG5cbiAgYXN5bmMgZ2V0VXNlcihpZDogc3RyaW5nKTogUHJvbWlzZTxOOG5Vc2VyPiB7XG4gICAgcmV0dXJuIHRoaXMubWFrZVJlcXVlc3Q8TjhuVXNlcj4oYC91c2Vycy8ke2lkfWApO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlVXNlcih1c2VyRGF0YTogQ3JlYXRlVXNlclJlcXVlc3QpOiBQcm9taXNlPE44blVzZXI+IHtcbiAgICByZXR1cm4gdGhpcy5tYWtlUmVxdWVzdDxOOG5Vc2VyPignL3VzZXJzJywge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh1c2VyRGF0YSksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyB1cGRhdGVVc2VyKGlkOiBzdHJpbmcsIHVzZXJEYXRhOiBVcGRhdGVVc2VyUmVxdWVzdCk6IFByb21pc2U8TjhuVXNlcj4ge1xuICAgIHJldHVybiB0aGlzLm1ha2VSZXF1ZXN0PE44blVzZXI+KGAvdXNlcnMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6ICdQQVRDSCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh1c2VyRGF0YSksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVVc2VyKGlkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0PHZvaWQ+KGAvdXNlcnMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gV29ya2Zsb3cgTWFuYWdlbWVudFxuICBhc3luYyBnZXRXb3JrZmxvd3Mob3B0aW9uczogUGFnaW5hdGlvbk9wdGlvbnMgPSB7fSk6IFByb21pc2U8QXBpUmVzcG9uc2U8TjhuV29ya2Zsb3dbXT4+IHtcbiAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgaWYgKG9wdGlvbnMubGltaXQpIHBhcmFtcy5hcHBlbmQoJ2xpbWl0Jywgb3B0aW9ucy5saW1pdC50b1N0cmluZygpKTtcbiAgICBpZiAob3B0aW9ucy5jdXJzb3IpIHBhcmFtcy5hcHBlbmQoJ2N1cnNvcicsIG9wdGlvbnMuY3Vyc29yKTtcblxuICAgIGNvbnN0IHF1ZXJ5ID0gcGFyYW1zLnRvU3RyaW5nKCkgPyBgPyR7cGFyYW1zLnRvU3RyaW5nKCl9YCA6ICcnO1xuICAgIHJldHVybiB0aGlzLm1ha2VSZXF1ZXN0PEFwaVJlc3BvbnNlPE44bldvcmtmbG93W10+PihgL3dvcmtmbG93cyR7cXVlcnl9YCk7XG4gIH1cblxuICBhc3luYyBnZXRXb3JrZmxvdyhpZDogc3RyaW5nKTogUHJvbWlzZTxOOG5Xb3JrZmxvdz4ge1xuICAgIHJldHVybiB0aGlzLm1ha2VSZXF1ZXN0PE44bldvcmtmbG93PihgL3dvcmtmbG93cy8ke2lkfWApO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlV29ya2Zsb3cod29ya2Zsb3dEYXRhOiBDcmVhdGVXb3JrZmxvd1JlcXVlc3QpOiBQcm9taXNlPE44bldvcmtmbG93PiB7XG4gICAgcmV0dXJuIHRoaXMubWFrZVJlcXVlc3Q8TjhuV29ya2Zsb3c+KCcvd29ya2Zsb3dzJywge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh3b3JrZmxvd0RhdGEpLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgdXBkYXRlV29ya2Zsb3coaWQ6IHN0cmluZywgd29ya2Zsb3dEYXRhOiBVcGRhdGVXb3JrZmxvd1JlcXVlc3QpOiBQcm9taXNlPE44bldvcmtmbG93PiB7XG4gICAgcmV0dXJuIHRoaXMubWFrZVJlcXVlc3Q8TjhuV29ya2Zsb3c+KGAvd29ya2Zsb3dzLyR7aWR9YCwge1xuICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHdvcmtmbG93RGF0YSksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVXb3JrZmxvdyhpZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5tYWtlUmVxdWVzdDx2b2lkPihgL3dvcmtmbG93cy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBhY3RpdmF0ZVdvcmtmbG93KGlkOiBzdHJpbmcpOiBQcm9taXNlPE44bldvcmtmbG93PiB7XG4gICAgcmV0dXJuIHRoaXMubWFrZVJlcXVlc3Q8TjhuV29ya2Zsb3c+KGAvd29ya2Zsb3dzLyR7aWR9L2FjdGl2YXRlYCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWFjdGl2YXRlV29ya2Zsb3coaWQ6IHN0cmluZyk6IFByb21pc2U8TjhuV29ya2Zsb3c+IHtcbiAgICByZXR1cm4gdGhpcy5tYWtlUmVxdWVzdDxOOG5Xb3JrZmxvdz4oYC93b3JrZmxvd3MvJHtpZH0vZGVhY3RpdmF0ZWAsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gRXhlY3V0aW9uIE1hbmFnZW1lbnRcbiAgYXN5bmMgZ2V0RXhlY3V0aW9ucyhvcHRpb25zOiBQYWdpbmF0aW9uT3B0aW9ucyA9IHt9KTogUHJvbWlzZTxBcGlSZXNwb25zZTxOOG5FeGVjdXRpb25bXT4+IHtcbiAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgaWYgKG9wdGlvbnMubGltaXQpIHBhcmFtcy5hcHBlbmQoJ2xpbWl0Jywgb3B0aW9ucy5saW1pdC50b1N0cmluZygpKTtcbiAgICBpZiAob3B0aW9ucy5jdXJzb3IpIHBhcmFtcy5hcHBlbmQoJ2N1cnNvcicsIG9wdGlvbnMuY3Vyc29yKTtcblxuICAgIGNvbnN0IHF1ZXJ5ID0gcGFyYW1zLnRvU3RyaW5nKCkgPyBgPyR7cGFyYW1zLnRvU3RyaW5nKCl9YCA6ICcnO1xuICAgIHJldHVybiB0aGlzLm1ha2VSZXF1ZXN0PEFwaVJlc3BvbnNlPE44bkV4ZWN1dGlvbltdPj4oYC9leGVjdXRpb25zJHtxdWVyeX1gKTtcbiAgfVxuXG4gIGFzeW5jIGdldEV4ZWN1dGlvbihpZDogc3RyaW5nKTogUHJvbWlzZTxOOG5FeGVjdXRpb24+IHtcbiAgICByZXR1cm4gdGhpcy5tYWtlUmVxdWVzdDxOOG5FeGVjdXRpb24+KGAvZXhlY3V0aW9ucy8ke2lkfWApO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlRXhlY3V0aW9uKGlkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0PHZvaWQ+KGAvZXhlY3V0aW9ucy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgfSk7XG4gIH1cblxuICAvLyBDcmVkZW50aWFsIE1hbmFnZW1lbnRcbiAgYXN5bmMgZ2V0Q3JlZGVudGlhbHMob3B0aW9uczogUGFnaW5hdGlvbk9wdGlvbnMgPSB7fSk6IFByb21pc2U8QXBpUmVzcG9uc2U8TjhuQ3JlZGVudGlhbFtdPj4ge1xuICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcbiAgICBpZiAob3B0aW9ucy5saW1pdCkgcGFyYW1zLmFwcGVuZCgnbGltaXQnLCBvcHRpb25zLmxpbWl0LnRvU3RyaW5nKCkpO1xuICAgIGlmIChvcHRpb25zLmN1cnNvcikgcGFyYW1zLmFwcGVuZCgnY3Vyc29yJywgb3B0aW9ucy5jdXJzb3IpO1xuXG4gICAgY29uc3QgcXVlcnkgPSBwYXJhbXMudG9TdHJpbmcoKSA/IGA/JHtwYXJhbXMudG9TdHJpbmcoKX1gIDogJyc7XG4gICAgcmV0dXJuIHRoaXMubWFrZVJlcXVlc3Q8QXBpUmVzcG9uc2U8TjhuQ3JlZGVudGlhbFtdPj4oYC9jcmVkZW50aWFscyR7cXVlcnl9YCk7XG4gIH1cblxuICBhc3luYyBnZXRDcmVkZW50aWFsKGlkOiBzdHJpbmcpOiBQcm9taXNlPE44bkNyZWRlbnRpYWw+IHtcbiAgICByZXR1cm4gdGhpcy5tYWtlUmVxdWVzdDxOOG5DcmVkZW50aWFsPihgL2NyZWRlbnRpYWxzLyR7aWR9YCk7XG4gIH1cblxuICBhc3luYyBjcmVhdGVDcmVkZW50aWFsKGNyZWRlbnRpYWxEYXRhOiBDcmVhdGVDcmVkZW50aWFsUmVxdWVzdCk6IFByb21pc2U8TjhuQ3JlZGVudGlhbD4ge1xuICAgIHJldHVybiB0aGlzLm1ha2VSZXF1ZXN0PE44bkNyZWRlbnRpYWw+KCcvY3JlZGVudGlhbHMnLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGNyZWRlbnRpYWxEYXRhKSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZUNyZWRlbnRpYWwoaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMubWFrZVJlcXVlc3Q8dm9pZD4oYC9jcmVkZW50aWFscy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBnZXRDcmVkZW50aWFsU2NoZW1hKGNyZWRlbnRpYWxUeXBlOiBzdHJpbmcpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG4gICAgcmV0dXJuIHRoaXMubWFrZVJlcXVlc3Q8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+KGAvY3JlZGVudGlhbHMvc2NoZW1hLyR7Y3JlZGVudGlhbFR5cGV9YCk7XG4gIH1cblxuICAvLyBQcm9qZWN0IE1hbmFnZW1lbnQgKEVudGVycHJpc2UpXG4gIGFzeW5jIGdldFByb2plY3RzKG9wdGlvbnM6IFBhZ2luYXRpb25PcHRpb25zID0ge30pOiBQcm9taXNlPEFwaVJlc3BvbnNlPE44blByb2plY3RbXT4+IHtcbiAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgaWYgKG9wdGlvbnMubGltaXQpIHBhcmFtcy5hcHBlbmQoJ2xpbWl0Jywgb3B0aW9ucy5saW1pdC50b1N0cmluZygpKTtcbiAgICBpZiAob3B0aW9ucy5jdXJzb3IpIHBhcmFtcy5hcHBlbmQoJ2N1cnNvcicsIG9wdGlvbnMuY3Vyc29yKTtcblxuICAgIGNvbnN0IHF1ZXJ5ID0gcGFyYW1zLnRvU3RyaW5nKCkgPyBgPyR7cGFyYW1zLnRvU3RyaW5nKCl9YCA6ICcnO1xuICAgIHJldHVybiB0aGlzLm1ha2VSZXF1ZXN0PEFwaVJlc3BvbnNlPE44blByb2plY3RbXT4+KGAvcHJvamVjdHMke3F1ZXJ5fWApO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlUHJvamVjdChwcm9qZWN0RGF0YTogQ3JlYXRlUHJvamVjdFJlcXVlc3QpOiBQcm9taXNlPE44blByb2plY3Q+IHtcbiAgICByZXR1cm4gdGhpcy5tYWtlUmVxdWVzdDxOOG5Qcm9qZWN0PignL3Byb2plY3RzJywge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwcm9qZWN0RGF0YSksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyB1cGRhdGVQcm9qZWN0KGlkOiBzdHJpbmcsIHByb2plY3REYXRhOiBVcGRhdGVQcm9qZWN0UmVxdWVzdCk6IFByb21pc2U8TjhuUHJvamVjdD4ge1xuICAgIHJldHVybiB0aGlzLm1ha2VSZXF1ZXN0PE44blByb2plY3Q+KGAvcHJvamVjdHMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocHJvamVjdERhdGEpLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlUHJvamVjdChpZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5tYWtlUmVxdWVzdDx2b2lkPihgL3Byb2plY3RzLyR7aWR9YCwge1xuICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFZhcmlhYmxlIE1hbmFnZW1lbnQgKEVudGVycHJpc2UpXG4gIGFzeW5jIGdldFZhcmlhYmxlcyhvcHRpb25zOiBQYWdpbmF0aW9uT3B0aW9ucyA9IHt9KTogUHJvbWlzZTxBcGlSZXNwb25zZTxOOG5WYXJpYWJsZVtdPj4ge1xuICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcbiAgICBpZiAob3B0aW9ucy5saW1pdCkgcGFyYW1zLmFwcGVuZCgnbGltaXQnLCBvcHRpb25zLmxpbWl0LnRvU3RyaW5nKCkpO1xuICAgIGlmIChvcHRpb25zLmN1cnNvcikgcGFyYW1zLmFwcGVuZCgnY3Vyc29yJywgb3B0aW9ucy5jdXJzb3IpO1xuXG4gICAgY29uc3QgcXVlcnkgPSBwYXJhbXMudG9TdHJpbmcoKSA/IGA/JHtwYXJhbXMudG9TdHJpbmcoKX1gIDogJyc7XG4gICAgcmV0dXJuIHRoaXMubWFrZVJlcXVlc3Q8QXBpUmVzcG9uc2U8TjhuVmFyaWFibGVbXT4+KGAvdmFyaWFibGVzJHtxdWVyeX1gKTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVZhcmlhYmxlKHZhcmlhYmxlRGF0YTogQ3JlYXRlVmFyaWFibGVSZXF1ZXN0KTogUHJvbWlzZTxOOG5WYXJpYWJsZT4ge1xuICAgIHJldHVybiB0aGlzLm1ha2VSZXF1ZXN0PE44blZhcmlhYmxlPignL3ZhcmlhYmxlcycsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkodmFyaWFibGVEYXRhKSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVZhcmlhYmxlKGlkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0PHZvaWQ+KGAvdmFyaWFibGVzLyR7aWR9YCwge1xuICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFRhZyBNYW5hZ2VtZW50XG4gIGFzeW5jIGdldFRhZ3Mob3B0aW9uczogUGFnaW5hdGlvbk9wdGlvbnMgPSB7fSk6IFByb21pc2U8QXBpUmVzcG9uc2U8TjhuVGFnW10+PiB7XG4gICAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcygpO1xuICAgIGlmIChvcHRpb25zLmxpbWl0KSBwYXJhbXMuYXBwZW5kKCdsaW1pdCcsIG9wdGlvbnMubGltaXQudG9TdHJpbmcoKSk7XG4gICAgaWYgKG9wdGlvbnMuY3Vyc29yKSBwYXJhbXMuYXBwZW5kKCdjdXJzb3InLCBvcHRpb25zLmN1cnNvcik7XG5cbiAgICBjb25zdCBxdWVyeSA9IHBhcmFtcy50b1N0cmluZygpID8gYD8ke3BhcmFtcy50b1N0cmluZygpfWAgOiAnJztcbiAgICByZXR1cm4gdGhpcy5tYWtlUmVxdWVzdDxBcGlSZXNwb25zZTxOOG5UYWdbXT4+KGAvdGFncyR7cXVlcnl9YCk7XG4gIH1cblxuICBhc3luYyBnZXRUYWcoaWQ6IHN0cmluZyk6IFByb21pc2U8TjhuVGFnPiB7XG4gICAgcmV0dXJuIHRoaXMubWFrZVJlcXVlc3Q8TjhuVGFnPihgL3RhZ3MvJHtpZH1gKTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVRhZyh0YWdEYXRhOiBDcmVhdGVUYWdSZXF1ZXN0KTogUHJvbWlzZTxOOG5UYWc+IHtcbiAgICByZXR1cm4gdGhpcy5tYWtlUmVxdWVzdDxOOG5UYWc+KCcvdGFncycsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkodGFnRGF0YSksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyB1cGRhdGVUYWcoaWQ6IHN0cmluZywgdGFnRGF0YTogVXBkYXRlVGFnUmVxdWVzdCk6IFByb21pc2U8TjhuVGFnPiB7XG4gICAgcmV0dXJuIHRoaXMubWFrZVJlcXVlc3Q8TjhuVGFnPihgL3RhZ3MvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkodGFnRGF0YSksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVUYWcoaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMubWFrZVJlcXVlc3Q8dm9pZD4oYC90YWdzLyR7aWR9YCwge1xuICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGdldFdvcmtmbG93VGFncyh3b3JrZmxvd0lkOiBzdHJpbmcpOiBQcm9taXNlPE44blRhZ1tdPiB7XG4gICAgcmV0dXJuIHRoaXMubWFrZVJlcXVlc3Q8TjhuVGFnW10+KGAvd29ya2Zsb3dzLyR7d29ya2Zsb3dJZH0vdGFnc2ApO1xuICB9XG5cbiAgYXN5bmMgdXBkYXRlV29ya2Zsb3dUYWdzKHdvcmtmbG93SWQ6IHN0cmluZywgdGFnSWRzOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMubWFrZVJlcXVlc3Q8dm9pZD4oYC93b3JrZmxvd3MvJHt3b3JrZmxvd0lkfS90YWdzYCwge1xuICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgdGFnSWRzIH0pLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gQXVkaXQgUmVwb3J0XG4gIGFzeW5jIGdlbmVyYXRlQXVkaXRSZXBvcnQoKTogUHJvbWlzZTxOOG5BdWRpdFJlcG9ydD4ge1xuICAgIHJldHVybiB0aGlzLm1ha2VSZXF1ZXN0PE44bkF1ZGl0UmVwb3J0PignL2F1ZGl0Jyk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==