4c942abe7cd1517264ef59f08d6921c8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createWorkflowTools = createWorkflowTools;
const zod_1 = require("zod");
const fastmcp_1 = require("fastmcp");
// Zod schemas for validation
const WorkflowIdSchema = zod_1.z.object({
    workflowId: zod_1.z.string().min(1, 'Workflow ID is required'),
});
const ListWorkflowsSchema = zod_1.z.object({
    limit: zod_1.z.number().min(1).max(100).optional(),
    cursor: zod_1.z.string().optional(),
});
const CreateWorkflowSchema = zod_1.z.object({
    name: zod_1.z.string().min(1, 'Workflow name is required'),
    nodes: zod_1.z.array(zod_1.z.record(zod_1.z.unknown())).min(1, 'At least one node is required'),
    connections: zod_1.z.record(zod_1.z.unknown()),
    active: zod_1.z.boolean().optional().default(false),
    settings: zod_1.z.record(zod_1.z.unknown()).optional(),
    tags: zod_1.z.array(zod_1.z.string()).optional(),
});
const UpdateWorkflowSchema = zod_1.z.object({
    workflowId: zod_1.z.string().min(1, 'Workflow ID is required'),
    name: zod_1.z.string().min(1).optional(),
    nodes: zod_1.z.array(zod_1.z.record(zod_1.z.unknown())).optional(),
    connections: zod_1.z.record(zod_1.z.unknown()).optional(),
    active: zod_1.z.boolean().optional(),
    settings: zod_1.z.record(zod_1.z.unknown()).optional(),
    tags: zod_1.z.array(zod_1.z.string()).optional(),
});
// Tool registration function
function createWorkflowTools(getClient, server) {
    // List workflows tool
    server.addTool({
        name: 'list-workflows',
        description: 'List all workflows in the n8n instance with pagination support',
        parameters: ListWorkflowsSchema,
        annotations: {
            title: 'List n8n Workflows',
            readOnlyHint: true,
            destructiveHint: false,
            idempotentHint: true,
            openWorldHint: true,
        },
        execute: async (args) => {
            const client = getClient();
            if (!client) {
                throw new fastmcp_1.UserError('n8n client not initialized. Please run init-n8n first.');
            }
            try {
                const options = {};
                if (args.limit)
                    options.limit = args.limit;
                if (args.cursor)
                    options.cursor = args.cursor;
                const response = await client.getWorkflows(options);
                if (response.data.length === 0) {
                    return 'No workflows found in the n8n instance.';
                }
                let result = `Found ${response.data.length} workflow(s):\n\n`;
                response.data.forEach((workflow, index) => {
                    result += `${index + 1}. **${workflow.name}**\n`;
                    result += `   - ID: ${workflow.id}\n`;
                    result += `   - Status: ${workflow.active ? 'ðŸŸ¢ Active' : 'ðŸ”´ Inactive'}\n`;
                    result += `   - Nodes: ${workflow.nodes?.length || 0}\n`;
                    if (workflow.tags && workflow.tags.length > 0) {
                        result += `   - Tags: ${workflow.tags.join(', ')}\n`;
                    }
                    if (workflow.createdAt) {
                        result += `   - Created: ${new Date(workflow.createdAt).toLocaleDateString()}\n`;
                    }
                    result += '\n';
                });
                if (response.nextCursor) {
                    result += `\nðŸ“„ Use cursor "${response.nextCursor}" to get the next page.`;
                }
                return result;
            }
            catch (error) {
                if (error instanceof Error) {
                    throw new fastmcp_1.UserError(`Failed to list workflows: ${error.message}`);
                }
                throw new fastmcp_1.UserError('Failed to list workflows with unknown error');
            }
        },
    });
    // Get workflow tool
    server.addTool({
        name: 'get-workflow',
        description: 'Get detailed information about a specific workflow by ID',
        parameters: WorkflowIdSchema,
        annotations: {
            title: 'Get Workflow Details',
            readOnlyHint: true,
            destructiveHint: false,
            idempotentHint: true,
            openWorldHint: true,
        },
        execute: async (args) => {
            const client = getClient();
            if (!client) {
                throw new fastmcp_1.UserError('n8n client not initialized. Please run init-n8n first.');
            }
            try {
                const workflow = await client.getWorkflow(args.workflowId);
                let result = `# Workflow: ${workflow.name}\n\n`;
                result += `**ID:** ${workflow.id}\n`;
                result += `**Status:** ${workflow.active ? 'ðŸŸ¢ Active' : 'ðŸ”´ Inactive'}\n`;
                result += `**Nodes:** ${workflow.nodes?.length || 0}\n`;
                if (workflow.tags && workflow.tags.length > 0) {
                    result += `**Tags:** ${workflow.tags.join(', ')}\n`;
                }
                if (workflow.createdAt) {
                    result += `**Created:** ${new Date(workflow.createdAt).toLocaleString()}\n`;
                }
                if (workflow.updatedAt) {
                    result += `**Updated:** ${new Date(workflow.updatedAt).toLocaleString()}\n`;
                }
                // List nodes
                if (workflow.nodes && workflow.nodes.length > 0) {
                    result += '\n## Nodes:\n';
                    workflow.nodes.forEach((node, index) => {
                        result += `${index + 1}. **${node.name || 'Unnamed Node'}** (${node.type || 'Unknown Type'})\n`;
                    });
                }
                return result;
            }
            catch (error) {
                if (error instanceof Error) {
                    throw new fastmcp_1.UserError(`Failed to get workflow: ${error.message}`);
                }
                throw new fastmcp_1.UserError('Failed to get workflow with unknown error');
            }
        },
    });
    // Create workflow tool
    server.addTool({
        name: 'create-workflow',
        description: 'Create a new workflow in n8n with nodes and connections',
        parameters: CreateWorkflowSchema,
        annotations: {
            title: 'Create New Workflow',
            readOnlyHint: false,
            destructiveHint: false,
            idempotentHint: false,
            openWorldHint: true,
        },
        execute: async (args) => {
            const client = getClient();
            if (!client) {
                throw new fastmcp_1.UserError('n8n client not initialized. Please run init-n8n first.');
            }
            try {
                const workflowData = {
                    name: args.name,
                    nodes: args.nodes,
                    connections: args.connections,
                    active: args.active,
                    settings: args.settings,
                    tags: args.tags,
                };
                const workflow = await client.createWorkflow(workflowData);
                return (`âœ… Successfully created workflow "${workflow.name}" with ID: ${workflow.id}\n` +
                    `Status: ${workflow.active ? 'ðŸŸ¢ Active' : 'ðŸ”´ Inactive'}\n` +
                    `Nodes: ${workflow.nodes?.length || 0}`);
            }
            catch (error) {
                if (error instanceof Error) {
                    throw new fastmcp_1.UserError(`Failed to create workflow: ${error.message}`);
                }
                throw new fastmcp_1.UserError('Failed to create workflow with unknown error');
            }
        },
    });
    // Update workflow tool
    server.addTool({
        name: 'update-workflow',
        description: "Update an existing workflow's properties, nodes, or connections",
        parameters: UpdateWorkflowSchema,
        annotations: {
            title: 'Update Workflow',
            readOnlyHint: false,
            destructiveHint: false,
            idempotentHint: true,
            openWorldHint: true,
        },
        execute: async (args) => {
            const client = getClient();
            if (!client) {
                throw new fastmcp_1.UserError('n8n client not initialized. Please run init-n8n first.');
            }
            try {
                const { workflowId, ...updateData } = args;
                const workflowData = updateData;
                const workflow = await client.updateWorkflow(workflowId, workflowData);
                return (`âœ… Successfully updated workflow "${workflow.name}" (ID: ${workflow.id})\n` +
                    `Status: ${workflow.active ? 'ðŸŸ¢ Active' : 'ðŸ”´ Inactive'}\n` +
                    `Nodes: ${workflow.nodes?.length || 0}`);
            }
            catch (error) {
                if (error instanceof Error) {
                    throw new fastmcp_1.UserError(`Failed to update workflow: ${error.message}`);
                }
                throw new fastmcp_1.UserError('Failed to update workflow with unknown error');
            }
        },
    });
    // Delete workflow tool
    server.addTool({
        name: 'delete-workflow',
        description: 'Delete a workflow from n8n permanently',
        parameters: WorkflowIdSchema,
        annotations: {
            title: 'Delete Workflow',
            readOnlyHint: false,
            destructiveHint: true,
            idempotentHint: true,
            openWorldHint: true,
        },
        execute: async (args) => {
            const client = getClient();
            if (!client) {
                throw new fastmcp_1.UserError('n8n client not initialized. Please run init-n8n first.');
            }
            try {
                await client.deleteWorkflow(args.workflowId);
                return `âœ… Successfully deleted workflow with ID: ${args.workflowId}`;
            }
            catch (error) {
                if (error instanceof Error) {
                    throw new fastmcp_1.UserError(`Failed to delete workflow: ${error.message}`);
                }
                throw new fastmcp_1.UserError('Failed to delete workflow with unknown error');
            }
        },
    });
    // Activate workflow tool
    server.addTool({
        name: 'activate-workflow',
        description: 'Activate a workflow to start receiving trigger events',
        parameters: WorkflowIdSchema,
        annotations: {
            title: 'Activate Workflow',
            readOnlyHint: false,
            destructiveHint: false,
            idempotentHint: true,
            openWorldHint: true,
        },
        execute: async (args) => {
            const client = getClient();
            if (!client) {
                throw new fastmcp_1.UserError('n8n client not initialized. Please run init-n8n first.');
            }
            try {
                const workflow = await client.activateWorkflow(args.workflowId);
                return (`âœ… Successfully activated workflow "${workflow.name}" (ID: ${workflow.id})\n` +
                    `Status: ðŸŸ¢ Active`);
            }
            catch (error) {
                if (error instanceof Error) {
                    throw new fastmcp_1.UserError(`Failed to activate workflow: ${error.message}`);
                }
                throw new fastmcp_1.UserError('Failed to activate workflow with unknown error');
            }
        },
    });
    // Deactivate workflow tool
    server.addTool({
        name: 'deactivate-workflow',
        description: 'Deactivate a workflow to stop receiving trigger events',
        parameters: WorkflowIdSchema,
        annotations: {
            title: 'Deactivate Workflow',
            readOnlyHint: false,
            destructiveHint: false,
            idempotentHint: true,
            openWorldHint: true,
        },
        execute: async (args) => {
            const client = getClient();
            if (!client) {
                throw new fastmcp_1.UserError('n8n client not initialized. Please run init-n8n first.');
            }
            try {
                const workflow = await client.deactivateWorkflow(args.workflowId);
                return (`âœ… Successfully deactivated workflow "${workflow.name}" (ID: ${workflow.id})\n` +
                    `Status: ðŸ”´ Inactive`);
            }
            catch (error) {
                if (error instanceof Error) {
                    throw new fastmcp_1.UserError(`Failed to deactivate workflow: ${error.message}`);
                }
                throw new fastmcp_1.UserError('Failed to deactivate workflow with unknown error');
            }
        },
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2plcmVteXBhcmtlci9EZXNrdG9wL0NsYXVkZSBDb2RpbmcgUHJvamVjdHMvbjhuLW1jcC1zZXJ2ZXIvc3JjL3Rvb2xzL3dvcmtmbG93LnRzIiwibWFwcGluZ3MiOiI7O0FBd0NBLGtEQXVTQztBQS9VRCw2QkFBd0I7QUFDeEIscUNBQW9DO0FBU3BDLDZCQUE2QjtBQUM3QixNQUFNLGdCQUFnQixHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDaEMsVUFBVSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLHlCQUF5QixDQUFDO0NBQ3pELENBQUMsQ0FBQztBQUVILE1BQU0sbUJBQW1CLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUNuQyxLQUFLLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFO0lBQzVDLE1BQU0sRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0NBQzlCLENBQUMsQ0FBQztBQUVILE1BQU0sb0JBQW9CLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUNwQyxJQUFJLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsMkJBQTJCLENBQUM7SUFDcEQsS0FBSyxFQUFFLE9BQUMsQ0FBQyxLQUFLLENBQUMsT0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsK0JBQStCLENBQUM7SUFDN0UsV0FBVyxFQUFFLE9BQUMsQ0FBQyxNQUFNLENBQUMsT0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2xDLE1BQU0sRUFBRSxPQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztJQUM3QyxRQUFRLEVBQUUsT0FB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LHdEQUF3RDtRQUNyRSxVQUFVLEVBQUUsZ0JBQWdCO1FBQzVCLFdBQVcsRUFBRTtZQUNYLEtBQUssRUFBRSxxQkFBcUI7WUFDNUIsWUFBWSxFQUFFLEtBQUs7WUFDbkIsZUFBZSxFQUFFLEtBQUs7WUFDdEIsY0FBYyxFQUFFLElBQUk7WUFDcEIsYUFBYSxFQUFFLElBQUk7U0FDcEI7UUFDRCxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQXNDLEVBQUUsRUFBRTtZQUN4RCxNQUFNLE1BQU0sR0FBRyxTQUFTLEVBQUUsQ0FBQztZQUMzQixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQ1osTUFBTSxJQUFJLG1CQUFTLENBQUMsd0RBQXdELENBQUMsQ0FBQztZQUNoRixDQUFDO1lBRUQsSUFBSSxDQUFDO2dCQUNILE1BQU0sUUFBUSxHQUFHLE1BQU0sTUFBTSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFFbEUsT0FBTyxDQUNMLHdDQUF3QyxRQUFRLENBQUMsSUFBSSxVQUFVLFFBQVEsQ0FBQyxFQUFFLEtBQUs7b0JBQy9FLHFCQUFxQixDQUN0QixDQUFDO1lBQ0osQ0FBQztZQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7Z0JBQ2YsSUFBSSxLQUFLLFlBQVksS0FBSyxFQUFFLENBQUM7b0JBQzNCLE1BQU0sSUFBSSxtQkFBUyxDQUFDLGtDQUFrQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztnQkFDekUsQ0FBQztnQkFDRCxNQUFNLElBQUksbUJBQVMsQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO1lBQzFFLENBQUM7UUFDSCxDQUFDO0tBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvamVyZW15cGFya2VyL0Rlc2t0b3AvQ2xhdWRlIENvZGluZyBQcm9qZWN0cy9uOG4tbWNwLXNlcnZlci9zcmMvdG9vbHMvd29ya2Zsb3cudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5pbXBvcnQgeyBVc2VyRXJyb3IgfSBmcm9tICdmYXN0bWNwJztcbmltcG9ydCB7IE44bkNsaWVudCB9IGZyb20gJy4uL2NsaWVudC9uOG5DbGllbnQuanMnO1xuaW1wb3J0IHtcbiAgTjhuV29ya2Zsb3csXG4gIENyZWF0ZVdvcmtmbG93UmVxdWVzdCxcbiAgVXBkYXRlV29ya2Zsb3dSZXF1ZXN0LFxuICBQYWdpbmF0aW9uT3B0aW9ucyxcbn0gZnJvbSAnLi4vdHlwZXMvbjhuLmpzJztcblxuLy8gWm9kIHNjaGVtYXMgZm9yIHZhbGlkYXRpb25cbmNvbnN0IFdvcmtmbG93SWRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHdvcmtmbG93SWQ6IHouc3RyaW5nKCkubWluKDEsICdXb3JrZmxvdyBJRCBpcyByZXF1aXJlZCcpLFxufSk7XG5cbmNvbnN0IExpc3RXb3JrZmxvd3NTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGxpbWl0OiB6Lm51bWJlcigpLm1pbigxKS5tYXgoMTAwKS5vcHRpb25hbCgpLFxuICBjdXJzb3I6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCBDcmVhdGVXb3JrZmxvd1NjaGVtYSA9IHoub2JqZWN0KHtcbiAgbmFtZTogei5zdHJpbmcoKS5taW4oMSwgJ1dvcmtmbG93IG5hbWUgaXMgcmVxdWlyZWQnKSxcbiAgbm9kZXM6IHouYXJyYXkoei5yZWNvcmQoei51bmtub3duKCkpKS5taW4oMSwgJ0F0IGxlYXN0IG9uZSBub2RlIGlzIHJlcXVpcmVkJyksXG4gIGNvbm5lY3Rpb25zOiB6LnJlY29yZCh6LnVua25vd24oKSksXG4gIGFjdGl2ZTogei5ib29sZWFuKCkub3B0aW9uYWwoKS5kZWZhdWx0KGZhbHNlKSxcbiAgc2V0dGluZ3M6IHoucmVjb3JkKHoudW5rbm93bigpKS5vcHRpb25hbCgpLFxuICB0YWdzOiB6LmFycmF5KHouc3RyaW5nKCkpLm9wdGlvbmFsKCksXG59KTtcblxuY29uc3QgVXBkYXRlV29ya2Zsb3dTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHdvcmtmbG93SWQ6IHouc3RyaW5nKCkubWluKDEsICdXb3JrZmxvdyBJRCBpcyByZXF1aXJlZCcpLFxuICBuYW1lOiB6LnN0cmluZygpLm1pbigxKS5vcHRpb25hbCgpLFxuICBub2Rlczogei5hcnJheSh6LnJlY29yZCh6LnVua25vd24oKSkpLm9wdGlvbmFsKCksXG4gIGNvbm5lY3Rpb25zOiB6LnJlY29yZCh6LnVua25vd24oKSkub3B0aW9uYWwoKSxcbiAgYWN0aXZlOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuICBzZXR0aW5nczogei5yZWNvcmQoei51bmtub3duKCkpLm9wdGlvbmFsKCksXG4gIHRhZ3M6IHouYXJyYXkoei5zdHJpbmcoKSkub3B0aW9uYWwoKSxcbn0pO1xuXG4vLyBUb29sIHJlZ2lzdHJhdGlvbiBmdW5jdGlvblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVdvcmtmbG93VG9vbHMoZ2V0Q2xpZW50OiAoKSA9PiBOOG5DbGllbnQgfCBudWxsLCBzZXJ2ZXI6IGFueSkge1xuICAvLyBMaXN0IHdvcmtmbG93cyB0b29sXG4gIHNlcnZlci5hZGRUb29sKHtcbiAgICBuYW1lOiAnbGlzdC13b3JrZmxvd3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnTGlzdCBhbGwgd29ya2Zsb3dzIGluIHRoZSBuOG4gaW5zdGFuY2Ugd2l0aCBwYWdpbmF0aW9uIHN1cHBvcnQnLFxuICAgIHBhcmFtZXRlcnM6IExpc3RXb3JrZmxvd3NTY2hlbWEsXG4gICAgYW5ub3RhdGlvbnM6IHtcbiAgICAgIHRpdGxlOiAnTGlzdCBuOG4gV29ya2Zsb3dzJyxcbiAgICAgIHJlYWRPbmx5SGludDogdHJ1ZSxcbiAgICAgIGRlc3RydWN0aXZlSGludDogZmFsc2UsXG4gICAgICBpZGVtcG90ZW50SGludDogdHJ1ZSxcbiAgICAgIG9wZW5Xb3JsZEhpbnQ6IHRydWUsXG4gICAgfSxcbiAgICBleGVjdXRlOiBhc3luYyAoYXJnczogei5pbmZlcjx0eXBlb2YgTGlzdFdvcmtmbG93c1NjaGVtYT4pID0+IHtcbiAgICAgIGNvbnN0IGNsaWVudCA9IGdldENsaWVudCgpO1xuICAgICAgaWYgKCFjbGllbnQpIHtcbiAgICAgICAgdGhyb3cgbmV3IFVzZXJFcnJvcignbjhuIGNsaWVudCBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBydW4gaW5pdC1uOG4gZmlyc3QuJyk7XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnM6IFBhZ2luYXRpb25PcHRpb25zID0ge307XG4gICAgICAgIGlmIChhcmdzLmxpbWl0KSBvcHRpb25zLmxpbWl0ID0gYXJncy5saW1pdDtcbiAgICAgICAgaWYgKGFyZ3MuY3Vyc29yKSBvcHRpb25zLmN1cnNvciA9IGFyZ3MuY3Vyc29yO1xuXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LmdldFdvcmtmbG93cyhvcHRpb25zKTtcblxuICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gJ05vIHdvcmtmbG93cyBmb3VuZCBpbiB0aGUgbjhuIGluc3RhbmNlLic7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmVzdWx0ID0gYEZvdW5kICR7cmVzcG9uc2UuZGF0YS5sZW5ndGh9IHdvcmtmbG93KHMpOlxcblxcbmA7XG5cbiAgICAgICAgcmVzcG9uc2UuZGF0YS5mb3JFYWNoKCh3b3JrZmxvdzogTjhuV29ya2Zsb3csIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgICByZXN1bHQgKz0gYCR7aW5kZXggKyAxfS4gKioke3dvcmtmbG93Lm5hbWV9KipcXG5gO1xuICAgICAgICAgIHJlc3VsdCArPSBgICAgLSBJRDogJHt3b3JrZmxvdy5pZH1cXG5gO1xuICAgICAgICAgIHJlc3VsdCArPSBgICAgLSBTdGF0dXM6ICR7d29ya2Zsb3cuYWN0aXZlID8gJ/Cfn6IgQWN0aXZlJyA6ICfwn5S0IEluYWN0aXZlJ31cXG5gO1xuICAgICAgICAgIHJlc3VsdCArPSBgICAgLSBOb2RlczogJHt3b3JrZmxvdy5ub2Rlcz8ubGVuZ3RoIHx8IDB9XFxuYDtcbiAgICAgICAgICBpZiAod29ya2Zsb3cudGFncyAmJiB3b3JrZmxvdy50YWdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJlc3VsdCArPSBgICAgLSBUYWdzOiAke3dvcmtmbG93LnRhZ3Muam9pbignLCAnKX1cXG5gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAod29ya2Zsb3cuY3JlYXRlZEF0KSB7XG4gICAgICAgICAgICByZXN1bHQgKz0gYCAgIC0gQ3JlYXRlZDogJHtuZXcgRGF0ZSh3b3JrZmxvdy5jcmVhdGVkQXQpLnRvTG9jYWxlRGF0ZVN0cmluZygpfVxcbmA7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3VsdCArPSAnXFxuJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHJlc3BvbnNlLm5leHRDdXJzb3IpIHtcbiAgICAgICAgICByZXN1bHQgKz0gYFxcbvCfk4QgVXNlIGN1cnNvciBcIiR7cmVzcG9uc2UubmV4dEN1cnNvcn1cIiB0byBnZXQgdGhlIG5leHQgcGFnZS5gO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFVzZXJFcnJvcihgRmFpbGVkIHRvIGxpc3Qgd29ya2Zsb3dzOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IFVzZXJFcnJvcignRmFpbGVkIHRvIGxpc3Qgd29ya2Zsb3dzIHdpdGggdW5rbm93biBlcnJvcicpO1xuICAgICAgfVxuICAgIH0sXG4gIH0pO1xuXG4gIC8vIEdldCB3b3JrZmxvdyB0b29sXG4gIHNlcnZlci5hZGRUb29sKHtcbiAgICBuYW1lOiAnZ2V0LXdvcmtmbG93JyxcbiAgICBkZXNjcmlwdGlvbjogJ0dldCBkZXRhaWxlZCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmljIHdvcmtmbG93IGJ5IElEJyxcbiAgICBwYXJhbWV0ZXJzOiBXb3JrZmxvd0lkU2NoZW1hLFxuICAgIGFubm90YXRpb25zOiB7XG4gICAgICB0aXRsZTogJ0dldCBXb3JrZmxvdyBEZXRhaWxzJyxcbiAgICAgIHJlYWRPbmx5SGludDogdHJ1ZSxcbiAgICAgIGRlc3RydWN0aXZlSGludDogZmFsc2UsXG4gICAgICBpZGVtcG90ZW50SGludDogdHJ1ZSxcbiAgICAgIG9wZW5Xb3JsZEhpbnQ6IHRydWUsXG4gICAgfSxcbiAgICBleGVjdXRlOiBhc3luYyAoYXJnczogei5pbmZlcjx0eXBlb2YgV29ya2Zsb3dJZFNjaGVtYT4pID0+IHtcbiAgICAgIGNvbnN0IGNsaWVudCA9IGdldENsaWVudCgpO1xuICAgICAgaWYgKCFjbGllbnQpIHtcbiAgICAgICAgdGhyb3cgbmV3IFVzZXJFcnJvcignbjhuIGNsaWVudCBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBydW4gaW5pdC1uOG4gZmlyc3QuJyk7XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHdvcmtmbG93ID0gYXdhaXQgY2xpZW50LmdldFdvcmtmbG93KGFyZ3Mud29ya2Zsb3dJZCk7XG5cbiAgICAgICAgbGV0IHJlc3VsdCA9IGAjIFdvcmtmbG93OiAke3dvcmtmbG93Lm5hbWV9XFxuXFxuYDtcbiAgICAgICAgcmVzdWx0ICs9IGAqKklEOioqICR7d29ya2Zsb3cuaWR9XFxuYDtcbiAgICAgICAgcmVzdWx0ICs9IGAqKlN0YXR1czoqKiAke3dvcmtmbG93LmFjdGl2ZSA/ICfwn5+iIEFjdGl2ZScgOiAn8J+UtCBJbmFjdGl2ZSd9XFxuYDtcbiAgICAgICAgcmVzdWx0ICs9IGAqKk5vZGVzOioqICR7d29ya2Zsb3cubm9kZXM/Lmxlbmd0aCB8fCAwfVxcbmA7XG5cbiAgICAgICAgaWYgKHdvcmtmbG93LnRhZ3MgJiYgd29ya2Zsb3cudGFncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmVzdWx0ICs9IGAqKlRhZ3M6KiogJHt3b3JrZmxvdy50YWdzLmpvaW4oJywgJyl9XFxuYDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh3b3JrZmxvdy5jcmVhdGVkQXQpIHtcbiAgICAgICAgICByZXN1bHQgKz0gYCoqQ3JlYXRlZDoqKiAke25ldyBEYXRlKHdvcmtmbG93LmNyZWF0ZWRBdCkudG9Mb2NhbGVTdHJpbmcoKX1cXG5gO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHdvcmtmbG93LnVwZGF0ZWRBdCkge1xuICAgICAgICAgIHJlc3VsdCArPSBgKipVcGRhdGVkOioqICR7bmV3IERhdGUod29ya2Zsb3cudXBkYXRlZEF0KS50b0xvY2FsZVN0cmluZygpfVxcbmA7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBMaXN0IG5vZGVzXG4gICAgICAgIGlmICh3b3JrZmxvdy5ub2RlcyAmJiB3b3JrZmxvdy5ub2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmVzdWx0ICs9ICdcXG4jIyBOb2RlczpcXG4nO1xuICAgICAgICAgIHdvcmtmbG93Lm5vZGVzLmZvckVhY2goKG5vZGUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICByZXN1bHQgKz0gYCR7aW5kZXggKyAxfS4gKioke25vZGUubmFtZSB8fCAnVW5uYW1lZCBOb2RlJ30qKiAoJHtub2RlLnR5cGUgfHwgJ1Vua25vd24gVHlwZSd9KVxcbmA7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgVXNlckVycm9yKGBGYWlsZWQgdG8gZ2V0IHdvcmtmbG93OiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IFVzZXJFcnJvcignRmFpbGVkIHRvIGdldCB3b3JrZmxvdyB3aXRoIHVua25vd24gZXJyb3InKTtcbiAgICAgIH1cbiAgICB9LFxuICB9KTtcblxuICAvLyBDcmVhdGUgd29ya2Zsb3cgdG9vbFxuICBzZXJ2ZXIuYWRkVG9vbCh7XG4gICAgbmFtZTogJ2NyZWF0ZS13b3JrZmxvdycsXG4gICAgZGVzY3JpcHRpb246ICdDcmVhdGUgYSBuZXcgd29ya2Zsb3cgaW4gbjhuIHdpdGggbm9kZXMgYW5kIGNvbm5lY3Rpb25zJyxcbiAgICBwYXJhbWV0ZXJzOiBDcmVhdGVXb3JrZmxvd1NjaGVtYSxcbiAgICBhbm5vdGF0aW9uczoge1xuICAgICAgdGl0bGU6ICdDcmVhdGUgTmV3IFdvcmtmbG93JyxcbiAgICAgIHJlYWRPbmx5SGludDogZmFsc2UsXG4gICAgICBkZXN0cnVjdGl2ZUhpbnQ6IGZhbHNlLFxuICAgICAgaWRlbXBvdGVudEhpbnQ6IGZhbHNlLFxuICAgICAgb3BlbldvcmxkSGludDogdHJ1ZSxcbiAgICB9LFxuICAgIGV4ZWN1dGU6IGFzeW5jIChhcmdzOiB6LmluZmVyPHR5cGVvZiBDcmVhdGVXb3JrZmxvd1NjaGVtYT4pID0+IHtcbiAgICAgIGNvbnN0IGNsaWVudCA9IGdldENsaWVudCgpO1xuICAgICAgaWYgKCFjbGllbnQpIHtcbiAgICAgICAgdGhyb3cgbmV3IFVzZXJFcnJvcignbjhuIGNsaWVudCBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBydW4gaW5pdC1uOG4gZmlyc3QuJyk7XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHdvcmtmbG93RGF0YTogQ3JlYXRlV29ya2Zsb3dSZXF1ZXN0ID0ge1xuICAgICAgICAgIG5hbWU6IGFyZ3MubmFtZSxcbiAgICAgICAgICBub2RlczogYXJncy5ub2RlcyxcbiAgICAgICAgICBjb25uZWN0aW9uczogYXJncy5jb25uZWN0aW9ucyxcbiAgICAgICAgICBhY3RpdmU6IGFyZ3MuYWN0aXZlLFxuICAgICAgICAgIHNldHRpbmdzOiBhcmdzLnNldHRpbmdzLFxuICAgICAgICAgIHRhZ3M6IGFyZ3MudGFncyxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCB3b3JrZmxvdyA9IGF3YWl0IGNsaWVudC5jcmVhdGVXb3JrZmxvdyh3b3JrZmxvd0RhdGEpO1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgYOKchSBTdWNjZXNzZnVsbHkgY3JlYXRlZCB3b3JrZmxvdyBcIiR7d29ya2Zsb3cubmFtZX1cIiB3aXRoIElEOiAke3dvcmtmbG93LmlkfVxcbmAgK1xuICAgICAgICAgIGBTdGF0dXM6ICR7d29ya2Zsb3cuYWN0aXZlID8gJ/Cfn6IgQWN0aXZlJyA6ICfwn5S0IEluYWN0aXZlJ31cXG5gICtcbiAgICAgICAgICBgTm9kZXM6ICR7d29ya2Zsb3cubm9kZXM/Lmxlbmd0aCB8fCAwfWBcbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFVzZXJFcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSB3b3JrZmxvdzogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBVc2VyRXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgd29ya2Zsb3cgd2l0aCB1bmtub3duIGVycm9yJyk7XG4gICAgICB9XG4gICAgfSxcbiAgfSk7XG5cbiAgLy8gVXBkYXRlIHdvcmtmbG93IHRvb2xcbiAgc2VydmVyLmFkZFRvb2woe1xuICAgIG5hbWU6ICd1cGRhdGUtd29ya2Zsb3cnLFxuICAgIGRlc2NyaXB0aW9uOiBcIlVwZGF0ZSBhbiBleGlzdGluZyB3b3JrZmxvdydzIHByb3BlcnRpZXMsIG5vZGVzLCBvciBjb25uZWN0aW9uc1wiLFxuICAgIHBhcmFtZXRlcnM6IFVwZGF0ZVdvcmtmbG93U2NoZW1hLFxuICAgIGFubm90YXRpb25zOiB7XG4gICAgICB0aXRsZTogJ1VwZGF0ZSBXb3JrZmxvdycsXG4gICAgICByZWFkT25seUhpbnQ6IGZhbHNlLFxuICAgICAgZGVzdHJ1Y3RpdmVIaW50OiBmYWxzZSxcbiAgICAgIGlkZW1wb3RlbnRIaW50OiB0cnVlLFxuICAgICAgb3BlbldvcmxkSGludDogdHJ1ZSxcbiAgICB9LFxuICAgIGV4ZWN1dGU6IGFzeW5jIChhcmdzOiB6LmluZmVyPHR5cGVvZiBVcGRhdGVXb3JrZmxvd1NjaGVtYT4pID0+IHtcbiAgICAgIGNvbnN0IGNsaWVudCA9IGdldENsaWVudCgpO1xuICAgICAgaWYgKCFjbGllbnQpIHtcbiAgICAgICAgdGhyb3cgbmV3IFVzZXJFcnJvcignbjhuIGNsaWVudCBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBydW4gaW5pdC1uOG4gZmlyc3QuJyk7XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgd29ya2Zsb3dJZCwgLi4udXBkYXRlRGF0YSB9ID0gYXJncztcbiAgICAgICAgY29uc3Qgd29ya2Zsb3dEYXRhOiBVcGRhdGVXb3JrZmxvd1JlcXVlc3QgPSB1cGRhdGVEYXRhO1xuXG4gICAgICAgIGNvbnN0IHdvcmtmbG93ID0gYXdhaXQgY2xpZW50LnVwZGF0ZVdvcmtmbG93KHdvcmtmbG93SWQsIHdvcmtmbG93RGF0YSk7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICBg4pyFIFN1Y2Nlc3NmdWxseSB1cGRhdGVkIHdvcmtmbG93IFwiJHt3b3JrZmxvdy5uYW1lfVwiIChJRDogJHt3b3JrZmxvdy5pZH0pXFxuYCArXG4gICAgICAgICAgYFN0YXR1czogJHt3b3JrZmxvdy5hY3RpdmUgPyAn8J+foiBBY3RpdmUnIDogJ/CflLQgSW5hY3RpdmUnfVxcbmAgK1xuICAgICAgICAgIGBOb2RlczogJHt3b3JrZmxvdy5ub2Rlcz8ubGVuZ3RoIHx8IDB9YFxuICAgICAgICApO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgVXNlckVycm9yKGBGYWlsZWQgdG8gdXBkYXRlIHdvcmtmbG93OiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IFVzZXJFcnJvcignRmFpbGVkIHRvIHVwZGF0ZSB3b3JrZmxvdyB3aXRoIHVua25vd24gZXJyb3InKTtcbiAgICAgIH1cbiAgICB9LFxuICB9KTtcblxuICAvLyBEZWxldGUgd29ya2Zsb3cgdG9vbFxuICBzZXJ2ZXIuYWRkVG9vbCh7XG4gICAgbmFtZTogJ2RlbGV0ZS13b3JrZmxvdycsXG4gICAgZGVzY3JpcHRpb246ICdEZWxldGUgYSB3b3JrZmxvdyBmcm9tIG44biBwZXJtYW5lbnRseScsXG4gICAgcGFyYW1ldGVyczogV29ya2Zsb3dJZFNjaGVtYSxcbiAgICBhbm5vdGF0aW9uczoge1xuICAgICAgdGl0bGU6ICdEZWxldGUgV29ya2Zsb3cnLFxuICAgICAgcmVhZE9ubHlIaW50OiBmYWxzZSxcbiAgICAgIGRlc3RydWN0aXZlSGludDogdHJ1ZSxcbiAgICAgIGlkZW1wb3RlbnRIaW50OiB0cnVlLFxuICAgICAgb3BlbldvcmxkSGludDogdHJ1ZSxcbiAgICB9LFxuICAgIGV4ZWN1dGU6IGFzeW5jIChhcmdzOiB6LmluZmVyPHR5cGVvZiBXb3JrZmxvd0lkU2NoZW1hPikgPT4ge1xuICAgICAgY29uc3QgY2xpZW50ID0gZ2V0Q2xpZW50KCk7XG4gICAgICBpZiAoIWNsaWVudCkge1xuICAgICAgICB0aHJvdyBuZXcgVXNlckVycm9yKCduOG4gY2xpZW50IG5vdCBpbml0aWFsaXplZC4gUGxlYXNlIHJ1biBpbml0LW44biBmaXJzdC4nKTtcbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgY2xpZW50LmRlbGV0ZVdvcmtmbG93KGFyZ3Mud29ya2Zsb3dJZCk7XG4gICAgICAgIHJldHVybiBg4pyFIFN1Y2Nlc3NmdWxseSBkZWxldGVkIHdvcmtmbG93IHdpdGggSUQ6ICR7YXJncy53b3JrZmxvd0lkfWA7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgIHRocm93IG5ldyBVc2VyRXJyb3IoYEZhaWxlZCB0byBkZWxldGUgd29ya2Zsb3c6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBuZXcgVXNlckVycm9yKCdGYWlsZWQgdG8gZGVsZXRlIHdvcmtmbG93IHdpdGggdW5rbm93biBlcnJvcicpO1xuICAgICAgfVxuICAgIH0sXG4gIH0pO1xuXG4gIC8vIEFjdGl2YXRlIHdvcmtmbG93IHRvb2xcbiAgc2VydmVyLmFkZFRvb2woe1xuICAgIG5hbWU6ICdhY3RpdmF0ZS13b3JrZmxvdycsXG4gICAgZGVzY3JpcHRpb246ICdBY3RpdmF0ZSBhIHdvcmtmbG93IHRvIHN0YXJ0IHJlY2VpdmluZyB0cmlnZ2VyIGV2ZW50cycsXG4gICAgcGFyYW1ldGVyczogV29ya2Zsb3dJZFNjaGVtYSxcbiAgICBhbm5vdGF0aW9uczoge1xuICAgICAgdGl0bGU6ICdBY3RpdmF0ZSBXb3JrZmxvdycsXG4gICAgICByZWFkT25seUhpbnQ6IGZhbHNlLFxuICAgICAgZGVzdHJ1Y3RpdmVIaW50OiBmYWxzZSxcbiAgICAgIGlkZW1wb3RlbnRIaW50OiB0cnVlLFxuICAgICAgb3BlbldvcmxkSGludDogdHJ1ZSxcbiAgICB9LFxuICAgIGV4ZWN1dGU6IGFzeW5jIChhcmdzOiB6LmluZmVyPHR5cGVvZiBXb3JrZmxvd0lkU2NoZW1hPikgPT4ge1xuICAgICAgY29uc3QgY2xpZW50ID0gZ2V0Q2xpZW50KCk7XG4gICAgICBpZiAoIWNsaWVudCkge1xuICAgICAgICB0aHJvdyBuZXcgVXNlckVycm9yKCduOG4gY2xpZW50IG5vdCBpbml0aWFsaXplZC4gUGxlYXNlIHJ1biBpbml0LW44biBmaXJzdC4nKTtcbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgd29ya2Zsb3cgPSBhd2FpdCBjbGllbnQuYWN0aXZhdGVXb3JrZmxvdyhhcmdzLndvcmtmbG93SWQpO1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgYOKchSBTdWNjZXNzZnVsbHkgYWN0aXZhdGVkIHdvcmtmbG93IFwiJHt3b3JrZmxvdy5uYW1lfVwiIChJRDogJHt3b3JrZmxvdy5pZH0pXFxuYCArXG4gICAgICAgICAgYFN0YXR1czog8J+foiBBY3RpdmVgXG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgIHRocm93IG5ldyBVc2VyRXJyb3IoYEZhaWxlZCB0byBhY3RpdmF0ZSB3b3JrZmxvdzogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBVc2VyRXJyb3IoJ0ZhaWxlZCB0byBhY3RpdmF0ZSB3b3JrZmxvdyB3aXRoIHVua25vd24gZXJyb3InKTtcbiAgICAgIH1cbiAgICB9LFxuICB9KTtcblxuICAvLyBEZWFjdGl2YXRlIHdvcmtmbG93IHRvb2xcbiAgc2VydmVyLmFkZFRvb2woe1xuICAgIG5hbWU6ICdkZWFjdGl2YXRlLXdvcmtmbG93JyxcbiAgICBkZXNjcmlwdGlvbjogJ0RlYWN0aXZhdGUgYSB3b3JrZmxvdyB0byBzdG9wIHJlY2VpdmluZyB0cmlnZ2VyIGV2ZW50cycsXG4gICAgcGFyYW1ldGVyczogV29ya2Zsb3dJZFNjaGVtYSxcbiAgICBhbm5vdGF0aW9uczoge1xuICAgICAgdGl0bGU6ICdEZWFjdGl2YXRlIFdvcmtmbG93JyxcbiAgICAgIHJlYWRPbmx5SGludDogZmFsc2UsXG4gICAgICBkZXN0cnVjdGl2ZUhpbnQ6IGZhbHNlLFxuICAgICAgaWRlbXBvdGVudEhpbnQ6IHRydWUsXG4gICAgICBvcGVuV29ybGRIaW50OiB0cnVlLFxuICAgIH0sXG4gICAgZXhlY3V0ZTogYXN5bmMgKGFyZ3M6IHouaW5mZXI8dHlwZW9mIFdvcmtmbG93SWRTY2hlbWE+KSA9PiB7XG4gICAgICBjb25zdCBjbGllbnQgPSBnZXRDbGllbnQoKTtcbiAgICAgIGlmICghY2xpZW50KSB7XG4gICAgICAgIHRocm93IG5ldyBVc2VyRXJyb3IoJ244biBjbGllbnQgbm90IGluaXRpYWxpemVkLiBQbGVhc2UgcnVuIGluaXQtbjhuIGZpcnN0LicpO1xuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB3b3JrZmxvdyA9IGF3YWl0IGNsaWVudC5kZWFjdGl2YXRlV29ya2Zsb3coYXJncy53b3JrZmxvd0lkKTtcblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIGDinIUgU3VjY2Vzc2Z1bGx5IGRlYWN0aXZhdGVkIHdvcmtmbG93IFwiJHt3b3JrZmxvdy5uYW1lfVwiIChJRDogJHt3b3JrZmxvdy5pZH0pXFxuYCArXG4gICAgICAgICAgYFN0YXR1czog8J+UtCBJbmFjdGl2ZWBcbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFVzZXJFcnJvcihgRmFpbGVkIHRvIGRlYWN0aXZhdGUgd29ya2Zsb3c6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBuZXcgVXNlckVycm9yKCdGYWlsZWQgdG8gZGVhY3RpdmF0ZSB3b3JrZmxvdyB3aXRoIHVua25vd24gZXJyb3InKTtcbiAgICAgIH1cbiAgICB9LFxuICB9KTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==