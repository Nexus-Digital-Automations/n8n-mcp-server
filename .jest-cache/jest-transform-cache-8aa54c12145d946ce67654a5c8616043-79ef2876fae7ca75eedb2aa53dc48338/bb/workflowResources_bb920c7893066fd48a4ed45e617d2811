e1222dc7e5285b705cfe59cc21bf496c
"use strict";
/**
 * Workflow Resources for n8n MCP Server
 *
 * Provides MCP resources for accessing n8n workflow data including definitions,
 * metadata, and configuration. Supports both static workflow access and dynamic
 * workflow discovery.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.WorkflowResourceManager = void 0;
exports.createWorkflowResources = createWorkflowResources;
/**
 * Workflow resource manager
 *
 * Manages workflow-related MCP resources including individual workflow access,
 * workflow listings, and workflow metadata.
 */
class WorkflowResourceManager {
    config;
    cache = new Map();
    constructor(config = {}) {
        this.config = {
            baseUri: 'n8n://workflows',
            maxWorkflows: 100,
            includeInactive: true,
            includeExecutions: false,
            cacheDuration: 5 * 60 * 1000, // 5 minutes
            ...config,
        };
    }
    /**
     * Register workflow resources with FastMCP server
     */
    register(server, getClient) {
        // Individual workflow resource template
        server.addResourceTemplate({
            uriTemplate: `${this.config.baseUri}/{id}`,
            name: 'n8n Workflow',
            mimeType: 'application/json',
            arguments: [
                {
                    name: 'id',
                    description: 'The ID of the n8n workflow',
                    required: true,
                },
            ],
            load: async ({ id }) => {
                const client = getClient();
                if (!client) {
                    throw new Error('n8n client not initialized. Run init-n8n first.');
                }
                const workflow = await this.getWorkflowResource(client, id);
                return {
                    text: JSON.stringify(workflow, null, 2),
                };
            },
        });
        // Workflow listing resource
        server.addResource({
            uri: `${this.config.baseUri}/list`,
            name: 'n8n Workflow List',
            mimeType: 'application/json',
            load: async () => {
                const client = getClient();
                if (!client) {
                    throw new Error('n8n client not initialized. Run init-n8n first.');
                }
                const workflows = await this.getWorkflowListResource(client);
                return {
                    text: JSON.stringify(workflows, null, 2),
                };
            },
        });
        // Active workflows resource
        server.addResource({
            uri: `${this.config.baseUri}/active`,
            name: 'n8n Active Workflows',
            mimeType: 'application/json',
            load: async () => {
                const client = getClient();
                if (!client) {
                    throw new Error('n8n client not initialized. Run init-n8n first.');
                }
                const activeWorkflows = await this.getActiveWorkflowsResource(client);
                return {
                    text: JSON.stringify(activeWorkflows, null, 2),
                };
            },
        });
        // Workflow statistics resource
        server.addResource({
            uri: `${this.config.baseUri}/stats`,
            name: 'n8n Workflow Statistics',
            mimeType: 'application/json',
            load: async () => {
                const client = getClient();
                if (!client) {
                    throw new Error('n8n client not initialized. Run init-n8n first.');
                }
                const stats = await this.getWorkflowStatsResource(client);
                return {
                    text: JSON.stringify(stats, null, 2),
                };
            },
        });
        // Workflow resource template for pattern matching
        server.addResourceTemplate({
            uriTemplate: `${this.config.baseUri}/{workflowId}`,
            name: 'n8n Workflow by ID',
            mimeType: 'application/json',
            arguments: [
                {
                    name: 'workflowId',
                    description: 'The ID of the n8n workflow',
                    required: true,
                },
            ],
            load: async ({ workflowId }) => {
                const client = getClient();
                if (!client) {
                    throw new Error('n8n client not initialized. Run init-n8n first.');
                }
                const workflow = await this.getWorkflowResource(client, workflowId);
                return {
                    text: JSON.stringify(workflow, null, 2),
                };
            },
        });
        console.log('ðŸ“„ Workflow resources registered');
    }
    /**
     * Get individual workflow resource
     */
    async getWorkflowResource(client, workflowId) {
        const cacheKey = `workflow:${workflowId}`;
        const cached = this.getCachedData(cacheKey);
        if (cached) {
            return cached;
        }
        try {
            const workflow = await client.getWorkflow(workflowId);
            // Enhance workflow data with metadata
            const enhancedWorkflow = {
                ...workflow,
                metadata: {
                    id: workflow.id,
                    name: workflow.name,
                    active: workflow.active,
                    tags: workflow.tags || [],
                    createdAt: workflow.createdAt,
                    updatedAt: workflow.updatedAt,
                    nodeCount: workflow.nodes?.length || 0,
                    connectionCount: workflow.connections ? Object.keys(workflow.connections).length : 0,
                },
                resourceInfo: {
                    uri: `${this.config.baseUri}/${workflowId}`,
                    type: 'n8n-workflow',
                    version: '1.0',
                    lastAccessed: new Date().toISOString(),
                },
            };
            this.setCachedData(cacheKey, enhancedWorkflow);
            return enhancedWorkflow;
        }
        catch (error) {
            throw new Error(`Failed to load workflow ${workflowId}: ${error instanceof Error ? error.message : String(error)}`);
        }
    }
    /**
     * Get workflow list resource
     */
    async getWorkflowListResource(client) {
        const cacheKey = 'workflows:list';
        const cached = this.getCachedData(cacheKey);
        if (cached) {
            return cached;
        }
        try {
            const workflows = await client.getWorkflows({
                limit: this.config.maxWorkflows,
            });
            const workflowList = {
                workflows: workflows.data.map(workflow => ({
                    id: workflow.id,
                    name: workflow.name,
                    active: workflow.active,
                    tags: workflow.tags || [],
                    createdAt: workflow.createdAt,
                    updatedAt: workflow.updatedAt,
                    uri: `${this.config.baseUri}/${workflow.id}`,
                })),
                metadata: {
                    total: workflows.data.length, // API doesn't provide total count
                    returned: workflows.data.length,
                    includeInactive: this.config.includeInactive,
                    maxWorkflows: this.config.maxWorkflows,
                },
                resourceInfo: {
                    uri: `${this.config.baseUri}/list`,
                    type: 'n8n-workflow-list',
                    version: '1.0',
                    lastAccessed: new Date().toISOString(),
                },
            };
            this.setCachedData(cacheKey, workflowList);
            return workflowList;
        }
        catch (error) {
            throw new Error(`Failed to load workflow list: ${error instanceof Error ? error.message : String(error)}`);
        }
    }
    /**
     * Get active workflows resource
     */
    async getActiveWorkflowsResource(client) {
        const cacheKey = 'workflows:active';
        const cached = this.getCachedData(cacheKey);
        if (cached) {
            return cached;
        }
        try {
            const workflows = await client.getWorkflows({
                limit: this.config.maxWorkflows,
            });
            // Filter for active workflows client-side
            const activeWorkflowsData = workflows.data.filter(w => w.active);
            const activeWorkflows = {
                activeWorkflows: activeWorkflowsData.map(workflow => ({
                    id: workflow.id,
                    name: workflow.name,
                    tags: workflow.tags || [],
                    lastExecution: workflow.updatedAt,
                    uri: `${this.config.baseUri}/${workflow.id}`,
                })),
                metadata: {
                    total: activeWorkflowsData.length,
                    returned: activeWorkflowsData.length,
                    activeOnly: true,
                },
                resourceInfo: {
                    uri: `${this.config.baseUri}/active`,
                    type: 'n8n-active-workflows',
                    version: '1.0',
                    lastAccessed: new Date().toISOString(),
                },
            };
            this.setCachedData(cacheKey, activeWorkflows);
            return activeWorkflows;
        }
        catch (error) {
            throw new Error(`Failed to load active workflows: ${error instanceof Error ? error.message : String(error)}`);
        }
    }
    /**
     * Get workflow statistics resource
     */
    async getWorkflowStatsResource(client) {
        const cacheKey = 'workflows:stats';
        const cached = this.getCachedData(cacheKey);
        if (cached) {
            return cached;
        }
        try {
            const workflows = await client.getWorkflows({
                limit: this.config.maxWorkflows,
            });
            const stats = {
                totalWorkflows: workflows.data.length,
                activeWorkflows: workflows.data.filter(w => w.active).length,
                inactiveWorkflows: workflows.data.filter(w => !w.active).length,
                tagUsage: this.calculateTagUsage(workflows.data),
                creationStats: this.calculateCreationStats(workflows.data),
                resourceInfo: {
                    uri: `${this.config.baseUri}/stats`,
                    type: 'n8n-workflow-stats',
                    version: '1.0',
                    lastAccessed: new Date().toISOString(),
                },
            };
            this.setCachedData(cacheKey, stats);
            return stats;
        }
        catch (error) {
            throw new Error(`Failed to load workflow statistics: ${error instanceof Error ? error.message : String(error)}`);
        }
    }
    /**
     * Calculate tag usage statistics
     */
    calculateTagUsage(workflows) {
        const tagUsage = {};
        workflows.forEach(workflow => {
            if (workflow.tags && Array.isArray(workflow.tags)) {
                workflow.tags.forEach((tag) => {
                    if (tag != null) {
                        const tagName = typeof tag === 'string' ? tag : tag?.name;
                        if (tagName) {
                            tagUsage[tagName] = (tagUsage[tagName] || 0) + 1;
                        }
                    }
                });
            }
        });
        return tagUsage;
    }
    /**
     * Calculate creation statistics
     */
    calculateCreationStats(workflows) {
        const now = new Date();
        const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        const oneMonthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
        return {
            createdLastWeek: workflows.filter(w => new Date(w.createdAt) > oneWeekAgo).length,
            createdLastMonth: workflows.filter(w => new Date(w.createdAt) > oneMonthAgo).length,
            updatedLastWeek: workflows.filter(w => new Date(w.updatedAt) > oneWeekAgo).length,
            updatedLastMonth: workflows.filter(w => new Date(w.updatedAt) > oneMonthAgo).length,
        };
    }
    /**
     * Get cached data if not expired
     */
    getCachedData(key) {
        const cached = this.cache.get(key);
        if (cached && cached.expires > Date.now()) {
            return cached.data;
        }
        return null;
    }
    /**
     * Set cached data with expiration
     */
    setCachedData(key, data) {
        if (this.config.cacheDuration > 0) {
            this.cache.set(key, {
                data,
                expires: Date.now() + this.config.cacheDuration,
            });
        }
    }
    /**
     * Clear resource cache
     */
    clearCache() {
        this.cache.clear();
    }
    /**
     * Get cache statistics
     */
    getCacheStats() {
        return {
            size: this.cache.size,
            keys: Array.from(this.cache.keys()),
        };
    }
}
exports.WorkflowResourceManager = WorkflowResourceManager;
/**
 * Create workflow resource manager
 */
function createWorkflowResources(config) {
    return new WorkflowResourceManager(config);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2plcmVteXBhcmtlci9EZXNrdG9wL0NsYXVkZSBDb2RpbmcgUHJvamVjdHMvbjhuLW1jcC1zZXJ2ZXIvc3JjL3Jlc291cmNlcy93b3JrZmxvd1Jlc291cmNlcy50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOzs7QUFnYUgsMERBRUM7QUF6WUQ7Ozs7O0dBS0c7QUFDSCxNQUFhLHVCQUF1QjtJQUMxQixNQUFNLENBQW1DO0lBQ3pDLEtBQUssR0FBRyxJQUFJLEdBQUcsRUFBMEMsQ0FBQztJQUVsRSxZQUFZLFNBQWlDLEVBQUU7UUFDN0MsSUFBSSxDQUFDLE1BQU0sR0FBRztZQUNaLE9BQU8sRUFBRSxpQkFBaUI7WUFDMUIsWUFBWSxFQUFFLEdBQUc7WUFDakIsZUFBZSxFQUFFLElBQUk7WUFDckIsaUJBQWlCLEVBQUUsS0FBSztZQUN4QixhQUFhLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFJLEVBQUUsWUFBWTtZQUMxQyxHQUFHLE1BQU07U0FDVixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0ksUUFBUSxDQUFDLE1BQWUsRUFBRSxTQUFpQztRQUNoRSx3Q0FBd0M7UUFDeEMsTUFBTSxDQUFDLG1CQUFtQixDQUFDO1lBQ3pCLFdBQVcsRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxPQUFPO1lBQzFDLElBQUksRUFBRSxjQUFjO1lBQ3BCLFFBQVEsRUFBRSxrQkFBa0I7WUFDNUIsU0FBUyxFQUFFO2dCQUNUO29CQUNFLElBQUksRUFBRSxJQUFJO29CQUNWLFdBQVcsRUFBRSw0QkFBNEI7b0JBQ3pDLFFBQVEsRUFBRSxJQUFJO2lCQUNmO2FBQ0Y7WUFDRCxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFrQixFQUFFLEVBQUU7Z0JBQ3JDLE1BQU0sTUFBTSxHQUFHLFNBQVMsRUFBRSxDQUFDO2dCQUMzQixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7b0JBQ1osTUFBTSxJQUFJLEtBQUssQ0FBQyxpREFBaUQsQ0FBQyxDQUFD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TUFBTSxDQUFDLGFBQWE7YUFDaEQsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNJLFVBQVU7UUFDZixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3JCLENBQUM7SUFFRDs7T0FFRztJQUNJLGFBQWE7UUFDbEIsT0FBTztZQUNMLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUk7WUFDckIsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztTQUNwQyxDQUFDO0lBQ0osQ0FBQztDQUNGO0FBNVhELDBEQTRYQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsdUJBQXVCLENBQUMsTUFBK0I7SUFDckUsT0FBTyxJQUFJLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzdDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2plcmVteXBhcmtlci9EZXNrdG9wL0NsYXVkZSBDb2RpbmcgUHJvamVjdHMvbjhuLW1jcC1zZXJ2ZXIvc3JjL3Jlc291cmNlcy93b3JrZmxvd1Jlc291cmNlcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFdvcmtmbG93IFJlc291cmNlcyBmb3IgbjhuIE1DUCBTZXJ2ZXJcbiAqXG4gKiBQcm92aWRlcyBNQ1AgcmVzb3VyY2VzIGZvciBhY2Nlc3NpbmcgbjhuIHdvcmtmbG93IGRhdGEgaW5jbHVkaW5nIGRlZmluaXRpb25zLFxuICogbWV0YWRhdGEsIGFuZCBjb25maWd1cmF0aW9uLiBTdXBwb3J0cyBib3RoIHN0YXRpYyB3b3JrZmxvdyBhY2Nlc3MgYW5kIGR5bmFtaWNcbiAqIHdvcmtmbG93IGRpc2NvdmVyeS5cbiAqL1xuXG5pbXBvcnQgeyBGYXN0TUNQIH0gZnJvbSAnZmFzdG1jcCc7XG5pbXBvcnQgeyBOOG5DbGllbnQgfSBmcm9tICcuLi9jbGllbnQvbjhuQ2xpZW50LmpzJztcblxuLyoqXG4gKiBXb3JrZmxvdyByZXNvdXJjZSBjb25maWd1cmF0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgV29ya2Zsb3dSZXNvdXJjZUNvbmZpZyB7XG4gIC8qKiBCYXNlIFVSSSBwcmVmaXggZm9yIHdvcmtmbG93IHJlc291cmNlcyAqL1xuICBiYXNlVXJpPzogc3RyaW5nO1xuXG4gIC8qKiBNYXhpbXVtIG51bWJlciBvZiB3b3JrZmxvd3MgdG8gaW5jbHVkZSBpbiBsaXN0aW5ncyAqL1xuICBtYXhXb3JrZmxvd3M/OiBudW1iZXI7XG5cbiAgLyoqIFdoZXRoZXIgdG8gaW5jbHVkZSBpbmFjdGl2ZSB3b3JrZmxvd3MgKi9cbiAgaW5jbHVkZUluYWN0aXZlPzogYm9vbGVhbjtcblxuICAvKiogV2hldGhlciB0byBpbmNsdWRlIHdvcmtmbG93IGV4ZWN1dGlvbiBoaXN0b3J5ICovXG4gIGluY2x1ZGVFeGVjdXRpb25zPzogYm9vbGVhbjtcblxuICAvKiogQ2FjaGUgZHVyYXRpb24gZm9yIHdvcmtmbG93IGRhdGEgKG1zKSAqL1xuICBjYWNoZUR1cmF0aW9uPzogbnVtYmVyO1xufVxuXG4vKipcbiAqIFdvcmtmbG93IHJlc291cmNlIG1hbmFnZXJcbiAqXG4gKiBNYW5hZ2VzIHdvcmtmbG93LXJlbGF0ZWQgTUNQIHJlc291cmNlcyBpbmNsdWRpbmcgaW5kaXZpZHVhbCB3b3JrZmxvdyBhY2Nlc3MsXG4gKiB3b3JrZmxvdyBsaXN0aW5ncywgYW5kIHdvcmtmbG93IG1ldGFkYXRhLlxuICovXG5leHBvcnQgY2xhc3MgV29ya2Zsb3dSZXNvdXJjZU1hbmFnZXIge1xuICBwcml2YXRlIGNvbmZpZzogUmVxdWlyZWQ8V29ya2Zsb3dSZXNvdXJjZUNvbmZpZz47XG4gIHByaXZhdGUgY2FjaGUgPSBuZXcgTWFwPHN0cmluZywgeyBkYXRhOiBhbnk7IGV4cGlyZXM6IG51bWJlciB9PigpO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogV29ya2Zsb3dSZXNvdXJjZUNvbmZpZyA9IHt9KSB7XG4gICAgdGhpcy5jb25maWcgPSB7XG4gICAgICBiYXNlVXJpOiAnbjhuOi8vd29ya2Zsb3dzJyxcbiAgICAgIG1heFdvcmtmbG93czogMTAwLFxuICAgICAgaW5jbHVkZUluYWN0aXZlOiB0cnVlLFxuICAgICAgaW5jbHVkZUV4ZWN1dGlvbnM6IGZhbHNlLFxuICAgICAgY2FjaGVEdXJhdGlvbjogNSAqIDYwICogMTAwMCwgLy8gNSBtaW51dGVzXG4gICAgICAuLi5jb25maWcsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciB3b3JrZmxvdyByZXNvdXJjZXMgd2l0aCBGYXN0TUNQIHNlcnZlclxuICAgKi9cbiAgcHVibGljIHJlZ2lzdGVyKHNlcnZlcjogRmFzdE1DUCwgZ2V0Q2xpZW50OiAoKSA9PiBOOG5DbGllbnQgfCBudWxsKTogdm9pZCB7XG4gICAgLy8gSW5kaXZpZHVhbCB3b3JrZmxvdyByZXNvdXJjZSB0ZW1wbGF0ZVxuICAgIHNlcnZlci5hZGRSZXNvdXJjZVRlbXBsYXRlKHtcbiAgICAgIHVyaVRlbXBsYXRlOiBgJHt0aGlzLmNvbmZpZy5iYXNlVXJpfS97aWR9YCxcbiAgICAgIG5hbWU6ICduOG4gV29ya2Zsb3cnLFxuICAgICAgbWltZVR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIGFyZ3VtZW50czogW1xuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ2lkJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ1RoZSBJRCBvZiB0aGUgbjhuIHdvcmtmbG93JyxcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBsb2FkOiBhc3luYyAoeyBpZCB9OiB7IGlkOiBzdHJpbmcgfSkgPT4ge1xuICAgICAgICBjb25zdCBjbGllbnQgPSBnZXRDbGllbnQoKTtcbiAgICAgICAgaWYgKCFjbGllbnQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ244biBjbGllbnQgbm90IGluaXRpYWxpemVkLiBSdW4gaW5pdC1uOG4gZmlyc3QuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB3b3JrZmxvdyA9IGF3YWl0IHRoaXMuZ2V0V29ya2Zsb3dSZXNvdXJjZShjbGllbnQsIGlkKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0ZXh0OiBKU09OLnN0cmluZ2lmeSh3b3JrZmxvdywgbnVsbCwgMiksXG4gICAgICAgIH07XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gV29ya2Zsb3cgbGlzdGluZyByZXNvdXJjZVxuICAgIHNlcnZlci5hZGRSZXNvdXJjZSh7XG4gICAgICB1cmk6IGAke3RoaXMuY29uZmlnLmJhc2VVcml9L2xpc3RgLFxuICAgICAgbmFtZTogJ244biBXb3JrZmxvdyBMaXN0JyxcbiAgICAgIG1pbWVUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICBsb2FkOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNsaWVudCA9IGdldENsaWVudCgpO1xuICAgICAgICBpZiAoIWNsaWVudCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbjhuIGNsaWVudCBub3QgaW5pdGlhbGl6ZWQuIFJ1biBpbml0LW44biBmaXJzdC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHdvcmtmbG93cyA9IGF3YWl0IHRoaXMuZ2V0V29ya2Zsb3dMaXN0UmVzb3VyY2UoY2xpZW50KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0ZXh0OiBKU09OLnN0cmluZ2lmeSh3b3JrZmxvd3MsIG51bGwsIDIpLFxuICAgICAgICB9O1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIEFjdGl2ZSB3b3JrZmxvd3MgcmVzb3VyY2VcbiAgICBzZXJ2ZXIuYWRkUmVzb3VyY2Uoe1xuICAgICAgdXJpOiBgJHt0aGlzLmNvbmZpZy5iYXNlVXJpfS9hY3RpdmVgLFxuICAgICAgbmFtZTogJ244biBBY3RpdmUgV29ya2Zsb3dzJyxcbiAgICAgIG1pbWVUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICBsb2FkOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNsaWVudCA9IGdldENsaWVudCgpO1xuICAgICAgICBpZiAoIWNsaWVudCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbjhuIGNsaWVudCBub3QgaW5pdGlhbGl6ZWQuIFJ1biBpbml0LW44biBmaXJzdC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFjdGl2ZVdvcmtmbG93cyA9IGF3YWl0IHRoaXMuZ2V0QWN0aXZlV29ya2Zsb3dzUmVzb3VyY2UoY2xpZW50KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0ZXh0OiBKU09OLnN0cmluZ2lmeShhY3RpdmVXb3JrZmxvd3MsIG51bGwsIDIpLFxuICAgICAgICB9O1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFdvcmtmbG93IHN0YXRpc3RpY3MgcmVzb3VyY2VcbiAgICBzZXJ2ZXIuYWRkUmVzb3VyY2Uoe1xuICAgICAgdXJpOiBgJHt0aGlzLmNvbmZpZy5iYXNlVXJpfS9zdGF0c2AsXG4gICAgICBuYW1lOiAnbjhuIFdvcmtmbG93IFN0YXRpc3RpY3MnLFxuICAgICAgbWltZVR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIGxvYWQ6IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgY2xpZW50ID0gZ2V0Q2xpZW50KCk7XG4gICAgICAgIGlmICghY2xpZW50KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCduOG4gY2xpZW50IG5vdCBpbml0aWFsaXplZC4gUnVuIGluaXQtbjhuIGZpcnN0LicpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCB0aGlzLmdldFdvcmtmbG93U3RhdHNSZXNvdXJjZShjbGllbnQpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRleHQ6IEpTT04uc3RyaW5naWZ5KHN0YXRzLCBudWxsLCAyKSxcbiAgICAgICAgfTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBXb3JrZmxvdyByZXNvdXJjZSB0ZW1wbGF0ZSBmb3IgcGF0dGVybiBtYXRjaGluZ1xuICAgIHNlcnZlci5hZGRSZXNvdXJjZVRlbXBsYXRlKHtcbiAgICAgIHVyaVRlbXBsYXRlOiBgJHt0aGlzLmNvbmZpZy5iYXNlVXJpfS97d29ya2Zsb3dJZH1gLFxuICAgICAgbmFtZTogJ244biBXb3JrZmxvdyBieSBJRCcsXG4gICAgICBtaW1lVHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgYXJndW1lbnRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnd29ya2Zsb3dJZCcsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdUaGUgSUQgb2YgdGhlIG44biB3b3JrZmxvdycsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgbG9hZDogYXN5bmMgKHsgd29ya2Zsb3dJZCB9OiB7IHdvcmtmbG93SWQ6IHN0cmluZyB9KSA9PiB7XG4gICAgICAgIGNvbnN0IGNsaWVudCA9IGdldENsaWVudCgpO1xuICAgICAgICBpZiAoIWNsaWVudCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbjhuIGNsaWVudCBub3QgaW5pdGlhbGl6ZWQuIFJ1biBpbml0LW44biBmaXJzdC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHdvcmtmbG93ID0gYXdhaXQgdGhpcy5nZXRXb3JrZmxvd1Jlc291cmNlKGNsaWVudCwgd29ya2Zsb3dJZCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGV4dDogSlNPTi5zdHJpbmdpZnkod29ya2Zsb3csIG51bGwsIDIpLFxuICAgICAgICB9O1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnNvbGUubG9nKCfwn5OEIFdvcmtmbG93IHJlc291cmNlcyByZWdpc3RlcmVkJyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGluZGl2aWR1YWwgd29ya2Zsb3cgcmVzb3VyY2VcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2V0V29ya2Zsb3dSZXNvdXJjZShjbGllbnQ6IE44bkNsaWVudCwgd29ya2Zsb3dJZDogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGB3b3JrZmxvdzoke3dvcmtmbG93SWR9YDtcbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLmdldENhY2hlZERhdGEoY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQpIHtcbiAgICAgIHJldHVybiBjYWNoZWQ7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHdvcmtmbG93ID0gYXdhaXQgY2xpZW50LmdldFdvcmtmbG93KHdvcmtmbG93SWQpO1xuXG4gICAgICAvLyBFbmhhbmNlIHdvcmtmbG93IGRhdGEgd2l0aCBtZXRhZGF0YVxuICAgICAgY29uc3QgZW5oYW5jZWRXb3JrZmxvdyA9IHtcbiAgICAgICAgLi4ud29ya2Zsb3csXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgaWQ6IHdvcmtmbG93LmlkLFxuICAgICAgICAgIG5hbWU6IHdvcmtmbG93Lm5hbWUsXG4gICAgICAgICAgYWN0aXZlOiB3b3JrZmxvdy5hY3RpdmUsXG4gICAgICAgICAgdGFnczogd29ya2Zsb3cudGFncyB8fCBbXSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IHdvcmtmbG93LmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IHdvcmtmbG93LnVwZGF0ZWRBdCxcbiAgICAgICAgICBub2RlQ291bnQ6IHdvcmtmbG93Lm5vZGVzPy5sZW5ndGggfHwgMCxcbiAgICAgICAgICBjb25uZWN0aW9uQ291bnQ6IHdvcmtmbG93LmNvbm5lY3Rpb25zID8gT2JqZWN0LmtleXMod29ya2Zsb3cuY29ubmVjdGlvbnMpLmxlbmd0aCA6IDAsXG4gICAgICAgIH0sXG4gICAgICAgIHJlc291cmNlSW5mbzoge1xuICAgICAgICAgIHVyaTogYCR7dGhpcy5jb25maWcuYmFzZVVyaX0vJHt3b3JrZmxvd0lkfWAsXG4gICAgICAgICAgdHlwZTogJ244bi13b3JrZmxvdycsXG4gICAgICAgICAgdmVyc2lvbjogJzEuMCcsXG4gICAgICAgICAgbGFzdEFjY2Vzc2VkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICB0aGlzLnNldENhY2hlZERhdGEoY2FjaGVLZXksIGVuaGFuY2VkV29ya2Zsb3cpO1xuICAgICAgcmV0dXJuIGVuaGFuY2VkV29ya2Zsb3c7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEZhaWxlZCB0byBsb2FkIHdvcmtmbG93ICR7d29ya2Zsb3dJZH06ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCB3b3JrZmxvdyBsaXN0IHJlc291cmNlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldFdvcmtmbG93TGlzdFJlc291cmNlKGNsaWVudDogTjhuQ2xpZW50KTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9ICd3b3JrZmxvd3M6bGlzdCc7XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5nZXRDYWNoZWREYXRhKGNhY2hlS2V5KTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4gY2FjaGVkO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCB3b3JrZmxvd3MgPSBhd2FpdCBjbGllbnQuZ2V0V29ya2Zsb3dzKHtcbiAgICAgICAgbGltaXQ6IHRoaXMuY29uZmlnLm1heFdvcmtmbG93cyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB3b3JrZmxvd0xpc3QgPSB7XG4gICAgICAgIHdvcmtmbG93czogd29ya2Zsb3dzLmRhdGEubWFwKHdvcmtmbG93ID0+ICh7XG4gICAgICAgICAgaWQ6IHdvcmtmbG93LmlkLFxuICAgICAgICAgIG5hbWU6IHdvcmtmbG93Lm5hbWUsXG4gICAgICAgICAgYWN0aXZlOiB3b3JrZmxvdy5hY3RpdmUsXG4gICAgICAgICAgdGFnczogd29ya2Zsb3cudGFncyB8fCBbXSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IHdvcmtmbG93LmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IHdvcmtmbG93LnVwZGF0ZWRBdCxcbiAgICAgICAgICB1cmk6IGAke3RoaXMuY29uZmlnLmJhc2VVcml9LyR7d29ya2Zsb3cuaWR9YCxcbiAgICAgICAgfSkpLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIHRvdGFsOiB3b3JrZmxvd3MuZGF0YS5sZW5ndGgsIC8vIEFQSSBkb2Vzbid0IHByb3ZpZGUgdG90YWwgY291bnRcbiAgICAgICAgICByZXR1cm5lZDogd29ya2Zsb3dzLmRhdGEubGVuZ3RoLFxuICAgICAgICAgIGluY2x1ZGVJbmFjdGl2ZTogdGhpcy5jb25maWcuaW5jbHVkZUluYWN0aXZlLFxuICAgICAgICAgIG1heFdvcmtmbG93czogdGhpcy5jb25maWcubWF4V29ya2Zsb3dzLFxuICAgICAgICB9LFxuICAgICAgICByZXNvdXJjZUluZm86IHtcbiAgICAgICAgICB1cmk6IGAke3RoaXMuY29uZmlnLmJhc2VVcml9L2xpc3RgLFxuICAgICAgICAgIHR5cGU6ICduOG4td29ya2Zsb3ctbGlzdCcsXG4gICAgICAgICAgdmVyc2lvbjogJzEuMCcsXG4gICAgICAgICAgbGFzdEFjY2Vzc2VkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICB0aGlzLnNldENhY2hlZERhdGEoY2FjaGVLZXksIHdvcmtmbG93TGlzdCk7XG4gICAgICByZXR1cm4gd29ya2Zsb3dMaXN0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBGYWlsZWQgdG8gbG9hZCB3b3JrZmxvdyBsaXN0OiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWN0aXZlIHdvcmtmbG93cyByZXNvdXJjZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZXRBY3RpdmVXb3JrZmxvd3NSZXNvdXJjZShjbGllbnQ6IE44bkNsaWVudCk6IFByb21pc2U8YW55PiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSAnd29ya2Zsb3dzOmFjdGl2ZSc7XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5nZXRDYWNoZWREYXRhKGNhY2hlS2V5KTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4gY2FjaGVkO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCB3b3JrZmxvd3MgPSBhd2FpdCBjbGllbnQuZ2V0V29ya2Zsb3dzKHtcbiAgICAgICAgbGltaXQ6IHRoaXMuY29uZmlnLm1heFdvcmtmbG93cyxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBGaWx0ZXIgZm9yIGFjdGl2ZSB3b3JrZmxvd3MgY2xpZW50LXNpZGVcbiAgICAgIGNvbnN0IGFjdGl2ZVdvcmtmbG93c0RhdGEgPSB3b3JrZmxvd3MuZGF0YS5maWx0ZXIodyA9PiB3LmFjdGl2ZSk7XG5cbiAgICAgIGNvbnN0IGFjdGl2ZVdvcmtmbG93cyA9IHtcbiAgICAgICAgYWN0aXZlV29ya2Zsb3dzOiBhY3RpdmVXb3JrZmxvd3NEYXRhLm1hcCh3b3JrZmxvdyA9PiAoe1xuICAgICAgICAgIGlkOiB3b3JrZmxvdy5pZCxcbiAgICAgICAgICBuYW1lOiB3b3JrZmxvdy5uYW1lLFxuICAgICAgICAgIHRhZ3M6IHdvcmtmbG93LnRhZ3MgfHwgW10sXG4gICAgICAgICAgbGFzdEV4ZWN1dGlvbjogd29ya2Zsb3cudXBkYXRlZEF0LFxuICAgICAgICAgIHVyaTogYCR7dGhpcy5jb25maWcuYmFzZVVyaX0vJHt3b3JrZmxvdy5pZH1gLFxuICAgICAgICB9KSksXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgdG90YWw6IGFjdGl2ZVdvcmtmbG93c0RhdGEubGVuZ3RoLFxuICAgICAgICAgIHJldHVybmVkOiBhY3RpdmVXb3JrZmxvd3NEYXRhLmxlbmd0aCxcbiAgICAgICAgICBhY3RpdmVPbmx5OiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICByZXNvdXJjZUluZm86IHtcbiAgICAgICAgICB1cmk6IGAke3RoaXMuY29uZmlnLmJhc2VVcml9L2FjdGl2ZWAsXG4gICAgICAgICAgdHlwZTogJ244bi1hY3RpdmUtd29ya2Zsb3dzJyxcbiAgICAgICAgICB2ZXJzaW9uOiAnMS4wJyxcbiAgICAgICAgICBsYXN0QWNjZXNzZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuc2V0Q2FjaGVkRGF0YShjYWNoZUtleSwgYWN0aXZlV29ya2Zsb3dzKTtcbiAgICAgIHJldHVybiBhY3RpdmVXb3JrZmxvd3M7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEZhaWxlZCB0byBsb2FkIGFjdGl2ZSB3b3JrZmxvd3M6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCB3b3JrZmxvdyBzdGF0aXN0aWNzIHJlc291cmNlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldFdvcmtmbG93U3RhdHNSZXNvdXJjZShjbGllbnQ6IE44bkNsaWVudCk6IFByb21pc2U8YW55PiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSAnd29ya2Zsb3dzOnN0YXRzJztcbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLmdldENhY2hlZERhdGEoY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQpIHtcbiAgICAgIHJldHVybiBjYWNoZWQ7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHdvcmtmbG93cyA9IGF3YWl0IGNsaWVudC5nZXRXb3JrZmxvd3Moe1xuICAgICAgICBsaW1pdDogdGhpcy5jb25maWcubWF4V29ya2Zsb3dzLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHN0YXRzID0ge1xuICAgICAgICB0b3RhbFdvcmtmbG93czogd29ya2Zsb3dzLmRhdGEubGVuZ3RoLFxuICAgICAgICBhY3RpdmVXb3JrZmxvd3M6IHdvcmtmbG93cy5kYXRhLmZpbHRlcih3ID0+IHcuYWN0aXZlKS5sZW5ndGgsXG4gICAgICAgIGluYWN0aXZlV29ya2Zsb3dzOiB3b3JrZmxvd3MuZGF0YS5maWx0ZXIodyA9PiAhdy5hY3RpdmUpLmxlbmd0aCxcbiAgICAgICAgdGFnVXNhZ2U6IHRoaXMuY2FsY3VsYXRlVGFnVXNhZ2Uod29ya2Zsb3dzLmRhdGEpLFxuICAgICAgICBjcmVhdGlvblN0YXRzOiB0aGlzLmNhbGN1bGF0ZUNyZWF0aW9uU3RhdHMod29ya2Zsb3dzLmRhdGEpLFxuICAgICAgICByZXNvdXJjZUluZm86IHtcbiAgICAgICAgICB1cmk6IGAke3RoaXMuY29uZmlnLmJhc2VVcml9L3N0YXRzYCxcbiAgICAgICAgICB0eXBlOiAnbjhuLXdvcmtmbG93LXN0YXRzJyxcbiAgICAgICAgICB2ZXJzaW9uOiAnMS4wJyxcbiAgICAgICAgICBsYXN0QWNjZXNzZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuc2V0Q2FjaGVkRGF0YShjYWNoZUtleSwgc3RhdHMpO1xuICAgICAgcmV0dXJuIHN0YXRzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBGYWlsZWQgdG8gbG9hZCB3b3JrZmxvdyBzdGF0aXN0aWNzOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgdGFnIHVzYWdlIHN0YXRpc3RpY3NcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlVGFnVXNhZ2Uod29ya2Zsb3dzOiBhbnlbXSk6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4ge1xuICAgIGNvbnN0IHRhZ1VzYWdlOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XG5cbiAgICB3b3JrZmxvd3MuZm9yRWFjaCh3b3JrZmxvdyA9PiB7XG4gICAgICBpZiAod29ya2Zsb3cudGFncyAmJiBBcnJheS5pc0FycmF5KHdvcmtmbG93LnRhZ3MpKSB7XG4gICAgICAgIHdvcmtmbG93LnRhZ3MuZm9yRWFjaCgodGFnOiBhbnkpID0+IHtcbiAgICAgICAgICBpZiAodGFnICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IHRhZ05hbWUgPSB0eXBlb2YgdGFnID09PSAnc3RyaW5nJyA/IHRhZyA6IHRhZz8ubmFtZTtcbiAgICAgICAgICAgIGlmICh0YWdOYW1lKSB7XG4gICAgICAgICAgICAgIHRhZ1VzYWdlW3RhZ05hbWVdID0gKHRhZ1VzYWdlW3RhZ05hbWVdIHx8IDApICsgMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRhZ1VzYWdlO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBjcmVhdGlvbiBzdGF0aXN0aWNzXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZUNyZWF0aW9uU3RhdHMod29ya2Zsb3dzOiBhbnlbXSk6IGFueSB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBvbmVXZWVrQWdvID0gbmV3IERhdGUobm93LmdldFRpbWUoKSAtIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICBjb25zdCBvbmVNb250aEFnbyA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgLSAzMCAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGNyZWF0ZWRMYXN0V2Vlazogd29ya2Zsb3dzLmZpbHRlcih3ID0+IG5ldyBEYXRlKHcuY3JlYXRlZEF0KSA+IG9uZVdlZWtBZ28pLmxlbmd0aCxcbiAgICAgIGNyZWF0ZWRMYXN0TW9udGg6IHdvcmtmbG93cy5maWx0ZXIodyA9PiBuZXcgRGF0ZSh3LmNyZWF0ZWRBdCkgPiBvbmVNb250aEFnbykubGVuZ3RoLFxuICAgICAgdXBkYXRlZExhc3RXZWVrOiB3b3JrZmxvd3MuZmlsdGVyKHcgPT4gbmV3IERhdGUody51cGRhdGVkQXQpID4gb25lV2Vla0FnbykubGVuZ3RoLFxuICAgICAgdXBkYXRlZExhc3RNb250aDogd29ya2Zsb3dzLmZpbHRlcih3ID0+IG5ldyBEYXRlKHcudXBkYXRlZEF0KSA+IG9uZU1vbnRoQWdvKS5sZW5ndGgsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FjaGVkIGRhdGEgaWYgbm90IGV4cGlyZWRcbiAgICovXG4gIHByaXZhdGUgZ2V0Q2FjaGVkRGF0YShrZXk6IHN0cmluZyk6IGFueSB8IG51bGwge1xuICAgIGNvbnN0IGNhY2hlZCA9IHRoaXMuY2FjaGUuZ2V0KGtleSk7XG4gICAgaWYgKGNhY2hlZCAmJiBjYWNoZWQuZXhwaXJlcyA+IERhdGUubm93KCkpIHtcbiAgICAgIHJldHVybiBjYWNoZWQuZGF0YTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogU2V0IGNhY2hlZCBkYXRhIHdpdGggZXhwaXJhdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBzZXRDYWNoZWREYXRhKGtleTogc3RyaW5nLCBkYXRhOiBhbnkpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb25maWcuY2FjaGVEdXJhdGlvbiA+IDApIHtcbiAgICAgIHRoaXMuY2FjaGUuc2V0KGtleSwge1xuICAgICAgICBkYXRhLFxuICAgICAgICBleHBpcmVzOiBEYXRlLm5vdygpICsgdGhpcy5jb25maWcuY2FjaGVEdXJhdGlvbixcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciByZXNvdXJjZSBjYWNoZVxuICAgKi9cbiAgcHVibGljIGNsZWFyQ2FjaGUoKTogdm9pZCB7XG4gICAgdGhpcy5jYWNoZS5jbGVhcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYWNoZSBzdGF0aXN0aWNzXG4gICAqL1xuICBwdWJsaWMgZ2V0Q2FjaGVTdGF0cygpOiB7IHNpemU6IG51bWJlcjsga2V5czogc3RyaW5nW10gfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNpemU6IHRoaXMuY2FjaGUuc2l6ZSxcbiAgICAgIGtleXM6IEFycmF5LmZyb20odGhpcy5jYWNoZS5rZXlzKCkpLFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgd29ya2Zsb3cgcmVzb3VyY2UgbWFuYWdlclxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlV29ya2Zsb3dSZXNvdXJjZXMoY29uZmlnPzogV29ya2Zsb3dSZXNvdXJjZUNvbmZpZyk6IFdvcmtmbG93UmVzb3VyY2VNYW5hZ2VyIHtcbiAgcmV0dXJuIG5ldyBXb3JrZmxvd1Jlc291cmNlTWFuYWdlcihjb25maWcpO1xufVxuIl0sInZlcnNpb24iOjN9